/***************************************
* @license
* Built December 02, 17 23:37:02
* Version: 0.1.9
* Minor version: jssdk-rc-0.1.8.151
***************************************/
("undefined"!=typeof _aurycDefine?_aurycDefine:define)(["require","_auryc","aurycConfig",_aurycNormalizeUrl("core/userty.utils.js"),_aurycNormalizeUrl("core/userty.behavior.js"),_aurycNormalizeUrl("core/userty.m.js")],function(e,t,aurycConfig,r,i,n){function o(){return location.href}var s={test:!0},a={SESSIONID:"sessid",GLOBALSESSIONID:"gsid",TRANSMITTING:"it",TRANSMIT_ENABLED:"it",CANCELED:"ic",CANCELEDPERMANENT:"icp",SESSION:"SESS",DATA:"DATA"},l=function(){};l.prototype.init=function(e){history.pushState&&window.addEventListener&&(this.path=o(),this.recorder=e,this.updateTrackerData=this.updateTrackerData.bind(this),this.originalPushState=history.pushState,history.pushState=function(e,t){e&&r.isObject(e)&&t&&(e.title=t),this.originalPushState.apply(history,arguments),this.updateTrackerData()}.bind(this),this.originalReplaceState=history.replaceState,history.replaceState=function(e,t){e&&r.isObject(e)&&t&&(e.title=t),this.originalReplaceState.apply(history,arguments),this.updateTrackerData()}.bind(this),window.addEventListener("popstate",this.updateTrackerData))},l.prototype.updateTrackerData=function(e){e=e!==!1,setTimeout(function(){var t=this.path,i=o();if(t!=i&&this.shouldTrackUrlChange.call(this,i,t)){this.path=i;var n=r.isObject(history.state)&&history.state&&history.state.title||document.title;e&&this.recorder.logUrlChangeEvent({url:i,title:n})}}.bind(this),0)},l.prototype.shouldTrackUrlChange=function(e,t){return e&&t},l.prototype.remove=function(){window.removeEventListener("popstate",this.updateTrackerData),history.replaceState=this.originalReplaceState,history.pushState=this.originalPushState,this.tracker=null,this.path=null,this.updateTrackerData=null,this.originalReplaceState=null,this.originalPushState=null};var c={remove:function(){this.parentNode&&this.parentNode.removeChild(this)},hasClass:function(e){return this.className.indexOf(e)>-1},addClass:function(e){this.hasClass(e)||(this.className+=" "+e)},removeClass:function(e){this.className=(this.className||"").replace(e,"")},$:function(e){return this.querySelectorAll(e)},css:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.style[t]=e[t])},getStyle:function(e){return window.getComputedStyle?window.getComputedStyle(this)[e]:this.currentStyle?this.currentStyle[e]:void 0}},h=function(e){if("string"==typeof e&&e.indexOf("<")==-1)return document.querySelectorAll(e);if("string"==typeof e){var t=document.createElement("div");t.innerHTML=e,e=t.firstChild}for(var r in c)c.hasOwnProperty(r)&&(e[r]=c[r]);return e},d={BitStream:function(e,t){if(this.index="number"==typeof t?t:0,this.bitindex=0,this.buffer=e instanceof Uint8Array?e:new Uint8Array(d.BitStream.DefaultBlockSize),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&this.expandBuffer()},byteArrayToString:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},stringToByteArray:function(e){for(var t=[],r=0;r<e.length;r++)t[t.length]=e.charCodeAt(r);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t},emojiToHtmlEntity:function(e){return e.replace(/\ud83c[\udf00-\udfff]|\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g,function(e){return"&#"+e.codePointAt(0)+";"})},timerFragAndCompress:function(e,t,i,n,o,s,a,l,c,h){r._.console.log("timerFragAndCompress: processing "+t+" - "+i);for(var u=t;u<i;u++){var g=e.substring(u*o,(u+1)*o);g=d.emojiToHtmlEntity(g);var p=d._utf8_encode(g),f=d.stringToByteArray(p),m=new d.RawDeflate(f,{compressionType:s}).compress(),y=btoa(d.byteArrayToString(m));l.push(y)}if(r._.console.log("timerFragAndCompress: finished processing "+t+" - "+i),i<n){var _=Math.min(n,i+a);r._.console.log("set timeout to process: "+i+" - "+_),setTimeout(function(){d.timerFragAndCompress(e,i,_,n,o,s,a,l,c,h)},c)}else r._.console.log("finished compressinbg all: "+l.length),h(l)},fragmentAndCompressV2:function(e,t,i,n){var o=5,s=25;t=t||1e5;var a=2;i&&(i.browser&&"Firefox"===i.browser.name||"Smartphone"===i.deviceType||"Feature Phone"===i.deviceType)&&(o=2,s=50),r._.console.log("compression type: "+a);var l=parseInt(e.length/t)+1,c=function(e){var t="";r._.console.log("finalizing array after compression: "+e.length);for(var i=0;i<e.length;i++)t+="_CMP_"+e[i];n(t)},h=[];r._.console.log("initiating timer. length: "+e.length+", fragment count:"+l);var u=Math.min(o,l);d.timerFragAndCompress(e,0,u,l,t,a,o,h,s,c)},fragmentAndCompress:function(e,t,i){t=t||1e5;var n=2;i&&i.browser&&"Firefox"===i.browser.name&&e.length>5e5&&(n=2),r._.console.log("compression type: "+n);var o="",s=parseInt(e.length/t)+1;r._.console.log("fragment count:"+s);for(var a=0;a<s;a++){var l=e.substring(a*t,(a+1)*t),c=d._utf8_encode(l),h=d.stringToByteArray(c),u=new d.RawDeflate(h,{compressionType:n}).compress(),g=btoa(d.byteArrayToString(u));o+="_CMP_"+g}return o}};d.BitStream.DefaultBlockSize=32768,d.BitStream.prototype.expandBuffer=function(){var e=this.buffer,t=e.length,r=new Uint8Array(t<<1);return r.set(e),this.buffer=r},d.BitStream.prototype.writeBits=function(e,t,r){var i=this.buffer,n=this.index,o=this.bitindex,s=i[n];if(r&&1<t&&(e=8<t?(d.BitStream.ReverseTable[255&e]<<24|d.BitStream.ReverseTable[e>>>8&255]<<16|d.BitStream.ReverseTable[e>>>16&255]<<8|d.BitStream.ReverseTable[e>>>24&255])>>32-t:d.BitStream.ReverseTable[e]>>8-t),8>t+o)s=s<<t|e,o+=t;else for(r=0;r<t;++r)s=s<<1|e>>t-r-1&1,8===++o&&(o=0,i[n++]=d.BitStream.ReverseTable[s],s=0,n===i.length&&(i=this.expandBuffer()));i[n]=s,this.buffer=i,this.bitindex=o,this.index=n},d.BitStream.prototype.finish=function(){var e=this.buffer,t=this.index;return 0<this.bitindex&&(e[t]<<=8-this.bitindex,e[t]=d.BitStream.ReverseTable[e[t]],t++),e=e.subarray(0,t)},d.BitStream.ReverseTable=function(e){return e}(function(){var e,t=new Uint8Array(256);for(e=0;256>e;++e){for(var r=t,i=e,n=e,o=n,s=7,n=n>>>1;n;n>>>=1)o<<=1,o|=1&n,--s;r[i]=(o<<s&255)>>>0}return t}()),d.Heap=function(e){this.buffer=new Uint16Array(2*e),this.length=0},d.Heap.prototype.getParent=function(e){return 2*((e-2)/4|0)},d.Heap.prototype.getChild=function(e){return 2*e+2},d.Heap.prototype.push=function(e,t){var r,i,n,o=this.buffer;for(r=this.length,o[this.length++]=t,o[this.length++]=e;0<r&&(i=this.getParent(r),o[r]>o[i]);)n=o[r],o[r]=o[i],o[i]=n,n=o[r+1],o[r+1]=o[i+1],o[i+1]=n,r=i;return this.length},d.Heap.prototype.pop=function(){var e,t,r,i,n,o=this.buffer;for(t=o[0],e=o[1],this.length-=2,o[0]=o[this.length],o[1]=o[this.length+1],n=0;(i=this.getChild(n),!(i>=this.length))&&(i+2<this.length&&o[i+2]>o[i]&&(i+=2),o[i]>o[n]);)r=o[n],o[n]=o[i],o[i]=r,r=o[n+1],o[n+1]=o[i+1],o[i+1]=r,n=i;return{index:e,value:t,length:this.length}},d.RawDeflate=function(e,t){this.compressionType=d.RawDeflate.CompressionType.DYNAMIC,this.lazy=0,this.input=e instanceof Array?new Uint8Array(e):e,this.op=0,t&&(t.lazy&&(this.lazy=t.lazy),"number"==typeof t.compressionType&&(this.compressionType=t.compressionType),t.outputBuffer&&(this.output=t.outputBuffer instanceof Array?new Uint8Array(t.outputBuffer):t.outputBuffer),"number"==typeof t.outputIndex&&(this.op=t.outputIndex)),this.output||(this.output=new Uint8Array(32768))},d.RawDeflate.CompressionType={NONE:0,FIXED:1,DYNAMIC:2,RESERVED:3},d.RawDeflate.Lz77MinLength=3,d.RawDeflate.Lz77MaxLength=258,d.RawDeflate.WindowSize=32768,d.RawDeflate.MaxCodeLength=16,d.RawDeflate.HUFMAX=286,d.RawDeflate.FixedHuffmanTable=function(){var e,t=[];for(e=0;288>e;e++)switch(!0){case 143>=e:t.push([e+48,8]);break;case 255>=e:t.push([e-144+400,9]);break;case 279>=e:t.push([e-256,7]);break;case 287>=e:t.push([e-280+192,8]);break;default:throw"invalid literal: "+e}return t}(),d.RawDeflate.prototype.compress=function(){var e,t,r,i=this.input;switch(this.compressionType){case d.RawDeflate.CompressionType.NONE:for(t=0,r=i.length;t<r;)e=i.subarray(t,t+65535),t+=e.length,this.makeNocompressBlock(e,t===r);break;case d.RawDeflate.CompressionType.FIXED:this.output=this.makeFixedHuffmanBlock(i,!0),this.op=this.output.length;break;case d.RawDeflate.CompressionType.DYNAMIC:this.output=this.makeDynamicHuffmanBlock(i,!0),this.op=this.output.length;break;default:throw"invalid compression type"}return this.output},d.RawDeflate.prototype.makeNocompressBlock=function(e,t){var r,i,n=this.output,o=this.op;for(n=new Uint8Array(this.output.buffer);n.length<=o+e.length+5;)n=new Uint8Array(n.length<<1);return n.set(this.output),r=d.RawDeflate.CompressionType.NONE,n[o++]=(t?1:0)|r<<1,r=e.length,i=~r+65536&65535,n[o++]=255&r,n[o++]=r>>>8&255,n[o++]=255&i,n[o++]=i>>>8&255,n.set(e,o),o+=e.length,n=n.subarray(0,o),this.op=o,this.output=n},d.RawDeflate.prototype.makeFixedHuffmanBlock=function(e,t){var r,i=new d.BitStream(new Uint8Array(this.output.buffer),this.op);return r=d.RawDeflate.CompressionType.FIXED,i.writeBits(t?1:0,1,!0),i.writeBits(r,2,!0),r=this.lz77(e),this.fixedHuffman(r,i),i.finish()},d.RawDeflate.prototype.makeDynamicHuffmanBlock=function(e,t){var r,i,n,o,s,a,l,c,h,u,g,p=new d.BitStream(new Uint8Array(this.output.buffer),this.op),f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],m=Array(19);for(r=d.RawDeflate.CompressionType.DYNAMIC,p.writeBits(t?1:0,1,!0),p.writeBits(r,2,!0),r=this.lz77(e),s=this.getLengths_(this.freqsLitLen,15),a=this.getCodesFromLengths_(s),l=this.getLengths_(this.freqsDist,7),c=this.getCodesFromLengths_(l),i=286;257<i&&0===s[i-1];i--);for(n=30;1<n&&0===l[n-1];n--);for(h=this.getTreeSymbols_(i,s,n,l),u=this.getLengths_(h.freqs,7),g=0;19>g;g++)m[g]=u[f[g]];for(o=19;4<o&&0===m[o-1];o--);for(f=this.getCodesFromLengths_(u),p.writeBits(i-257,5,!0),p.writeBits(n-1,5,!0),p.writeBits(o-4,4,!0),g=0;g<o;g++)p.writeBits(m[g],3,!0);for(g=0,m=h.codes.length;g<m;g++)if(i=h.codes[g],p.writeBits(f[i],u[i],!0),16<=i){switch(g++,i){case 16:i=2;break;case 17:i=3;break;case 18:i=7;break;default:throw"invalid code: "+i}p.writeBits(h.codes[g],i,!0)}return this.dynamicHuffman(r,[a,s],[c,l],p),p.finish()},d.RawDeflate.prototype.dynamicHuffman=function(e,t,r,i){var n,o,s,a,l;for(s=t[0],t=t[1],a=r[0],l=r[1],r=0,n=e.length;r<n;++r)if(o=e[r],i.writeBits(s[o],t[o],!0),256<o)i.writeBits(e[++r],e[++r],!0),o=e[++r],i.writeBits(a[o],l[o],!0),i.writeBits(e[++r],e[++r],!0);else if(256===o)break;return i},d.RawDeflate.prototype.fixedHuffman=function(e,t){var r,i,n;for(r=0,i=e.length;r<i;r++)if(n=e[r],d.BitStream.prototype.writeBits.apply(t,d.RawDeflate.FixedHuffmanTable[n]),256<n)t.writeBits(e[++r],e[++r],!0),t.writeBits(e[++r],5),t.writeBits(e[++r],e[++r],!0);else if(256===n)break;return t},d.RawDeflate.Lz77Match=function(e,t){this.length=e,this.backwardDistance=t},d.RawDeflate.Lz77Match.LengthCodeTable=function(e){return new Uint32Array(e)}(function(){function e(e){switch(!0){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:throw"invalid length: "+e}}var t,r,i=[];for(t=3;258>=t;t++)r=e(t),i[t]=r[2]<<24|r[1]<<16|r[0];return i}()),d.RawDeflate.Lz77Match.prototype.getDistanceCode_=function(e){switch(!0){case 1===e:e=[0,e-1,0];break;case 2===e:e=[1,e-2,0];break;case 3===e:e=[2,e-3,0];break;case 4===e:e=[3,e-4,0];break;case 6>=e:e=[4,e-5,1];break;case 8>=e:e=[5,e-7,1];break;case 12>=e:e=[6,e-9,2];break;case 16>=e:e=[7,e-13,2];break;case 24>=e:e=[8,e-17,3];break;case 32>=e:e=[9,e-25,3];break;case 48>=e:e=[10,e-33,4];break;case 64>=e:e=[11,e-49,4];break;case 96>=e:e=[12,e-65,5];break;case 128>=e:e=[13,e-97,5];break;case 192>=e:e=[14,e-129,6];break;case 256>=e:e=[15,e-193,6];break;case 384>=e:e=[16,e-257,7];break;case 512>=e:e=[17,e-385,7];break;case 768>=e:e=[18,e-513,8];break;case 1024>=e:e=[19,e-769,8];break;case 1536>=e:e=[20,e-1025,9];break;case 2048>=e:e=[21,e-1537,9];break;case 3072>=e:e=[22,e-2049,10];break;case 4096>=e:e=[23,e-3073,10];break;case 6144>=e:e=[24,e-4097,11];break;case 8192>=e:e=[25,e-6145,11];break;case 12288>=e:e=[26,e-8193,12];break;case 16384>=e:e=[27,e-12289,12];break;case 24576>=e:e=[28,e-16385,13];break;case 32768>=e:e=[29,e-24577,13];break;default:throw"invalid distance"}return e},d.RawDeflate.Lz77Match.prototype.toLz77Array=function(){var e,t=this.backwardDistance,r=[],i=0;return e=d.RawDeflate.Lz77Match.LengthCodeTable[this.length],r[i++]=65535&e,r[i++]=e>>16&255,r[i++]=e>>24,e=this.getDistanceCode_(t),r[i++]=e[0],r[i++]=e[1],r[i++]=e[2],r},d.RawDeflate.prototype.lz77=function(e){function t(e,t){var r,i,n=e.toLz77Array();for(r=0,i=n.length;r<i;++r)h[u++]=n[r];p[n[0]]++,f[n[3]]++,g=e.length+t-1,a=null}var r,i,n,o,s,a,l={},c=d.RawDeflate.WindowSize,h=new Uint16Array(2*e.length),u=0,g=0,p=new Uint32Array(286),f=new Uint32Array(30),m=this.lazy;for(n=0;285>=n;)p[n++]=0;for(n=0;29>=n;)f[n++]=0;for(p[256]=1,r=0,i=e.length;r<i;++r){for(n=s=0,o=d.RawDeflate.Lz77MinLength;n<o&&r+n!==i;++n)s=s<<8|e[r+n];if(void 0===l[s]&&(l[s]=[]),n=l[s],!(0<g--)){for(;0<n.length&&r-n[0]>c;)n.shift();if(r+d.RawDeflate.Lz77MinLength>=i){for(a&&t(a,-1),n=0,o=i-r;n<o;++n)s=e[r+n],h[u++]=s,++p[s];break}0<n.length?(o=this.searchLongestMatch_(e,r,n),a?a.length<o.length?(s=e[r-1],h[u++]=s,++p[s],t(o,0)):t(a,-1):o.length<m?a=o:t(o,0)):a?t(a,-1):(s=e[r],h[u++]=s,++p[s])}n.push(r)}return h[u++]=256,p[256]++,this.freqsLitLen=p,this.freqsDist=f,h.subarray(0,u)},d.RawDeflate.prototype.searchLongestMatch_=function(e,t,r){var i,n,o,s,a,l=0,c=e.length;s=0,a=r.length;e:for(;s<a;s++){if(i=r[a-s-1],o=d.RawDeflate.Lz77MinLength,l>d.RawDeflate.Lz77MinLength){for(o=l;o>d.RawDeflate.Lz77MinLength;o--)if(e[i+o-1]!==e[t+o-1])continue e;o=l}for(;o<d.RawDeflate.Lz77MaxLength&&t+o<c&&e[i+o]===e[t+o];)++o;if(o>l&&(n=i,l=o),o===d.RawDeflate.Lz77MaxLength)break}return new d.RawDeflate.Lz77Match(l,t-n)},d.RawDeflate.prototype.getTreeSymbols_=function(e,t,r,i){var n,o,s=new Uint32Array(e+r),a=new Uint32Array(316),l=new Uint8Array(19);for(n=o=0;n<e;n++)s[o++]=t[n];for(n=0;n<r;n++)s[o++]=i[n];for(n=0,t=l.length;n<t;++n)l[n]=0;for(n=r=0,t=s.length;n<t;n+=o){for(o=1;n+o<t&&s[n+o]===s[n];++o);if(e=o,0===s[n])if(3>e)for(;0<e--;)a[r++]=0,l[0]++;else for(;0<e;)i=138>e?e:138,i>e-3&&i<e&&(i=e-3),10>=i?(a[r++]=17,a[r++]=i-3,l[17]++):(a[r++]=18,a[r++]=i-11,l[18]++),e-=i;else if(a[r++]=s[n],l[s[n]]++,e--,3>e)for(;0<e--;)a[r++]=s[n],l[s[n]]++;else for(;0<e;)i=6>e?e:6,i>e-3&&i<e&&(i=e-3),a[r++]=16,a[r++]=i-3,l[16]++,e-=i}return{codes:a.subarray(0,r),freqs:l}},d.RawDeflate.prototype.getLengths_=function(e,t){var r,i,n,o=e.length,s=new d.Heap(2*d.RawDeflate.HUFMAX),a=new Uint8Array(o);for(i=0;i<o;i++)a[i]=0;for(i=0;i<o;++i)0<e[i]&&s.push(i,e[i]);if(o=Array(s.length/2),r=new Uint32Array(s.length/2),1===o.length)return a[s.pop().index]=1,a;for(i=0,n=s.length/2;i<n;++i)o[i]=s.pop(),r[i]=o[i].value;for(s=this.reversePackageMerge_(r,r.length,t),i=0,n=o.length;i<n;++i)a[o[i].index]=s[i];return a},d.RawDeflate.prototype.reversePackageMerge_=function(e,t,r){function i(e){var r=h[e][d[e]];r===t?(i(e+1),i(e+1)):--l[r],++d[e]}var n,o,s=new Uint16Array(r),a=new Uint8Array(r),l=new Uint8Array(t),c=Array(r),h=Array(r),d=Array(r),u=(1<<r)-t,g=1<<r-1;for(s[r-1]=t,n=0;n<r;++n)u<g?a[n]=0:(a[n]=1,u-=g),u<<=1,s[r-2-n]=(s[r-1-n]/2|0)+t;for(s[0]=a[0],c[0]=Array(s[0]),h[0]=Array(s[0]),n=1;n<r;++n)s[n]>2*s[n-1]+a[n]&&(s[n]=2*s[n-1]+a[n]),c[n]=Array(s[n]),h[n]=Array(s[n]);for(u=0;u<t;++u)l[u]=r;for(g=0;g<s[r-1];++g)c[r-1][g]=e[g],h[r-1][g]=g;for(u=0;u<r;++u)d[u]=0;for(1===a[r-1]&&(--l[0],++d[r-1]),n=r-2;0<=n;--n){for(r=u=0,o=d[n+1],g=0;g<s[n];g++)r=c[n+1][o]+c[n+1][o+1],r>e[u]?(c[n][g]=r,h[n][g]=t,o+=2):(c[n][g]=e[u],h[n][g]=u,++u);d[n]=0,1===a[n]&&i(n)}return l},d.RawDeflate.prototype.getCodesFromLengths_=function(e){var t,r,i,n=new Uint16Array(e.length),o=[],s=[],a=0;for(t=0,r=e.length;t<r;t++)o[e[t]]=(0|o[e[t]])+1;for(t=1,r=d.RawDeflate.MaxCodeLength;t<=r;t++)s[t]=a,a+=0|o[t],a<<=1;for(t=0,r=e.length;t<r;t++)for(a=s[e[t]],s[e[t]]+=1,o=n[t]=0,i=e[t];o<i;o++)n[t]=n[t]<<1|1&a,a>>>=1;return n},d.CompressionMethod={DEFLATE:8,RESERVED:15};var u={_trackers:[]};u.Tracker=function(e,t,i,n,o,s){this.recorder=e,this.throttleTime=n,this.recFunction=o,this.subject=t,s||this._capture({},t),r.Bind(t,i,function(e,t){return function(r){e._capture&&e._capture(r,t),r=null,t=null}}(this,t)),u._trackers.push(this),t=null,e=null,i=null,o=null},u.Tracker.prototype.merge=function(e,t,i,n){r.Bind(t,i,function(e,t,r){return function(i){e._capture&&e._capture(i,t,r)}}(this,t,e)),e=null,i=null,n=null},u.Tracker.prototype._capture=function(e,t,i){clearTimeout(this.lastCapThrottle);var n=i||this.recorder;if(!this.lastCap||r.now()-this.lastCap>this.throttleTime)this.recFunction.call(this,e,t,n),this.lastCap=r.now();else{var o={};for(var s in e)6==s.length&&"layerX"!=s&&"layerY"!=s&&(o[s]=e[s]);this.lastCapThrottle=setTimeout(function(e,t,i,n){return r.isDefined(t.clientX)&&(t.sX=t.clientX,t.sY=t.clientY),function(){t.delayed=!0,e._capture&&e._capture(t,i,n)}}(this,o,t,n),this.throttleTime)}n=null,i=null,e=null,t=null},u.Tracker.prototype.dispose=function(){this.lastCapThrottle&&clearTimeout(this.lastCapThrottle),r.superDispose(this)};var g=u.Tracker,p={iFrameXpaths:{}};p.performFrameBindings=function(e,t){for(var i=(t||e.win.document).querySelectorAll("iframe"),n=function(e){return function(){e.dispose()}},o=function(e){return function(t){p.bindToFrameLoad(t,e)}},s=0;s<i.length;s++){var a=i[s];if(!a._arB&&!a.getAttribute("_arB")||!p.iFrameXpaths[E.getMapping(a)]){if(p.iFrameXpaths[E.getMapping(a)]=!0,a.setAttribute("_arB",!0),this.testFrameSrc(a)&&this.testFrameOrigin(a)){var l=this.getFrameWindow(a);if(!l)return;var c=this.getFrameDocument(l,!1),h=!1;if(c){this.unbindInternalIframes(c);try{"complete, loaded".indexOf(c.readyState)>-1&&(h=!0)}catch(d){}h&&(r.isDefined(l.recorder)?l.recorder.serializeDom():(l.recorder=new O(l,E.getMapping(a),e),e.childRecorders.push(l.recorder),r.Bind(l,"unload",n(l.recorder))))}l=null}r.BindOnce(a,"record:load",o(e))}a=null}i=null,e=null},p.bindToFrameLoad=function(e,t){var i=e.originalTarget||e.target||e.srcElement;if(i&&this.testFrameSrc(i)&&p.testFrameOrigin(i)){var n=p.getFrameWindow(i);p.getFrameDocument(n)&&(r.isDefined(n.recorder)||(n.recorder=new O(n,E.getMapping(i),t),t.childRecorders.push(n.recorder))),n=null}i=null,t=null,e=null},p.testFrameSrc=function(e){for(var t=["javascript:","shim.gif","about:blank"],r=0;r<t.length;r++)if(e.src.indexOf(t[r])>-1)return!1;return!0},p.testFrameOrigin=function(e,t){var i=e.getAttribute("src");if(!i||0===i.indexOf(" "))return!1;var n=e.src;return r.testSameDomain(t||window.location.href,n)},p.unbindInternalIframes=function(e){for(var t=e.querySelectorAll("iframe[_arB='true']"),r=0;r<t.length;r++)t[r]._arB=!1},p.getFrameWindow=function(e){var t;return e&&e.contentWindow?t=e.contentWindow:e&&e.contentDocument&&e.contentDocument.defaultView&&(t=e.contentDocument.defaultView),t&&t!=t.top?t:null},p.getFrameDocument=function(e){var t;try{return t=e.document}catch(r){return!1}};var f=[],m=function(e,t){if(!t._arTracker){t._arTracker=this,f.push(this),this.input=t,this.recorder=e,this.caretPosAtKeyDown=-1;var i="";if(i=t.getAttribute("type")?t.getAttribute("type").toLowerCase():"text",this._isTextInput()&&(this.lastValue=t.getAttribute("value")||""),((!this._isTextInput()||t.value)&&("checkbox"!=i||t.checked)||t.type&&"select-one"==t.type)&&this.serialize(!0),r.Bind(t,"record:scroll",function(e){return function(t){e.input&&e.recorder.getLogger().log(e.recorder,D.EVENT_TYPES.SCROLL_EL,{t:i,x:e.recorder.getLogger().logXPath(e.recorder,E.getMapping(e.input)),ps:{x:e.input.scrollLeft,y:e.input.scrollTop}})}}(this)),r.Bind(t,"record:focus",function(e){return function(t){e.input&&(e._isTextInput()&&(e._updateCaret(),e._caretMonitor=setInterval(function(e){return function(){e.input&&e._updateCaret()}}(e),500)),e.recorder.getLogger().log(e.recorder,D.EVENT_TYPES.FOCUS_BLUR,{t:i,st:1,x:e.recorder.getLogger().logXPath(e.recorder,E.getMapping(e.input))}))}}(this)),r.Bind(t,"record:blur",function(e){return function(t){e.input&&(e._isTextInput()&&clearInterval(e._caretMonitor),e.recorder.getLogger().log(e.recorder,D.EVENT_TYPES.FOCUS_BLUR,{t:i,st:0,x:e.recorder.getLogger().logXPath(e.recorder,E.getMapping(e.input))}))}}(this)),"checkbox"==i||"radio"==i){var n=function(e){return function(t){e.input&&e._lastCheckedState!=e.input.checked&&(e._lastCheckedState=e.input.checked,e.recorder.getLogger().log(e.recorder,D.EVENT_TYPES.VALUE_CHANGED,{a:e.getNodeName(e.input),t:i,b:e.input.checked,x:e.recorder.getLogger().logXPath(e.recorder,E.getMapping(e.input))}))}}(this);r.Bind(t,"record:click",n),r.Bind(e.win,"record:click",n)}"checkbox"!=i&&"radio"!=i&&r.Bind(t,"record:change",function(e){return function(t){e.input&&(e._lastSelectListContents!=e.input.innerHTML&&e.serialize(),e.lastValue=e.input.value,e.recorder.getLogger().log(e.recorder,D.EVENT_TYPES.VALUE_CHANGED,{a:e.getNodeName(e.input),t:i,si:e.input.selectedIndex,x:e.recorder.getLogger().logXPath(e.recorder,E.getMapping(e.input))}))}}(this)),this._isTextInput()&&(this.lastValue=this.input.value,r.Bind(t,"record:keydown",function(e){return function(t){e.input&&(C._browser.isIE&&(t={keyCode:t.keyCode,charCode:t.charCode}),setTimeout(function(e,t){return function(){e._updateCaret();var n=0;if("number"==typeof t.keyCode?n=t.keyCode:"number"==typeof t.which?n=t.which:"number"==typeof t.charCode&&(n=t.charCode),Math.abs(e.lastValue.length-e.input.value.length)>1||e.lastCaretInfo.e-e.lastCaretInfo.s>1||e.caretPosAtKeyDown>-1&&Math.abs(e.lastCaretInfo.c-e.caretPosAtKeyDown)>1)r._.console.log("value: "+e.input.value+", cp:"+e.caretPosAtKeyDown+", c:",e.lastCaretInfo),e.serialize();else{0===n&&32==t.charCode&&(n=t.charCode);var o=e.recorder.getLogger().logXPath(e.recorder,E.getMapping(e.input));if(n<=46||n>=91&&n<96||n>=112&&n<=145)e.recorder.getLogger().log(e.recorder,D.EVENT_TYPES.KEY_PRESS,{t:i,xp:o,sk:n,ps:{x:e.input.scrollTop,y:e.input.scrollLeft}});else{var s=e._filterTextIfApplicable(e.input.value.substr(e.lastCaretInfo.c-1,1));r._.console.log("value: "+e.input.value+", v:"+s+", c:",e.lastCaretInfo),e.recorder.getLogger().log(e.recorder,D.EVENT_TYPES.KEY_PRESS,{a:e.getNodeName(e.input),t:i,xp:o,v:s,ps:{x:e.input.scrollTop,y:e.input.scrollLeft}})}}e.lastValue=e.input.value,e.caretPosAtKeyDown=e.lastCaretInfo.c}}(e,t),1))}}(this))),e=null,t=null}};m.prototype.hasChanged=function(){return this._lastCheckedState!=this.input.checked||this.lastValue!=this.input.value},m.prototype._filterTextIfApplicable=function(e){return e&&this._isSecret()?e.replace(/[^ \n\r\t]/g,"*"):e},m.prototype._isSecret=function(e){return e||(e=this.input),r.isSecretEl(e)},m.prototype._isTextInput=function(){var e="text",t=["text","password","textarea","number","email","url","search","color","tel",""];return this.input.getAttribute("type")&&(e=this.input.getAttribute("type").toLowerCase()),this.input.tagName&&"textarea"==this.input.tagName.toLowerCase()||r.inArray(e,t)},m.prototype.getNodeName=function(e){if(!e)return"";var t="";return e.labels&&e.labels.length>0&&(t=e.labels[0].textContent||e.labels[0].innerText),t||!e.getAttribute("data-text")||this._isSecret(e)||(t=e.getAttribute("data-text")),t||(t=e.name||e.nodeName,t&&(t=t.toLowerCase(),e.type&&(t+='[type="'+e.type.toLowerCase()+'"]'))),t},m.prototype.serialize=function(e){var t=this.input.tagName&&this.input.tagName.toLowerCase()||"",r=this.input.getAttribute("type");if(r||(r=this.input.tagName&&this.input.tagName.toLowerCase()||"","input"==r&&(r="text")),"hidden"!=r){if(e){if(!("radio"!=r&&"checkbox"!=r||this.input.checked))return void(this._lastCheckedState=!1);if(("text"==r||"password"==r||"textarea"==t)&&""===this.input.value)return}var i=this.recorder.getLogger(),n=D.EVENT_TYPES.INPUT_SERIALIZE,o=i.logXPath(this.recorder,E.getMapping(this.input));switch(r="select,textarea".indexOf(t)>-1?t:r){case"textarea":i.log(this.recorder,n,{a:this.getNodeName(this.input),t:r,x:o,v:this._filterTextIfApplicable(this.input.value)||"",wt:x.getStyle(this.input,this.recorder.win,"width"),ht:x.getStyle(this.input,this.recorder.win,"height")});break;case"radio":case"checkbox":!this.input.checked&&e||(i.log(this.recorder,n,{a:this.getNodeName(this.input),t:r,x:o,b:this.input.checked}),this._lastCheckedState=this.input.checked);break;case"select":for(var s=[],a=0;a<this.input.options.length;a++)s[s.length]={v:this._filterTextIfApplicable(this.input.options[a].value),t:this._filterTextIfApplicable(this.input.options[a].text)};!this.input.multiple&&this._isSecret()&&s.length>1&&(s.length=1),i.log(this.recorder,n,{a:this.getNodeName(this.input),t:r,x:o,sz:{w:this.input.offsetWidth,h:this.input.offsetHeight},o:s,si:this.input.options.selectedIndex}),this._lastSelectListContents=this.input.innerHTML;break;default:i.log(this.recorder,n,{a:this.getNodeName(this.input),t:r,x:o,v:this._filterTextIfApplicable(this.input.value)||""})}}},m.prototype._updateCaret=function(){var e=this._getCaretInfo(this.input);this.lastCaretInfo&&this.lastCaretInfo.s==e.s&&this.lastCaretInfo.e==e.e&&this.lastCaretInfo.c==e.c||setTimeout(function(e,t){return function(){e.recorder.getLogger().log(e.recorder,D.EVENT_TYPES.CARET_INFO,t)}}(this,{a:this.getNodeName(this.input),x:this.recorder.getLogger().logXPath(this.recorder,E.getMapping(this.input)),ci:e}),1),this.lastCaretInfo=e},m.prototype._getCaretInfo=function(){var e=this.input,t=e.value,r=e.ownerDocument,i={s:0,e:0,c:0};if(C._browser.isIE&&r&&r.selection)if(e.tagName&&"textarea"==e.tagName.toLowerCase()){t.charCodeAt(t.length-1)<14&&(t=t.replace(/34/g,"")+String.fromCharCode(28));var n=r.selection.createRange(),o=n.duplicate();o.moveToElementText(e),o.setEndPoint("StartToEnd",n),i.e=t.length-o.text.length,o.setEndPoint("StartToStart",n),i.s=t.length-o.text.length,i.c=i.e,t.substr(t.length-1)==String.fromCharCode(28)&&(t=t.substr(0,t.length-1));var s=t.substr(0,i.s).split("\n").length-1,a=t.substr(0,i.c).split("\n").length-1,l=t.substr(0,i.e).split("\n").length-1;i.c-=a,i.s-=s,i.e-=l}else{var c=r.selection.createRange(),h=c.duplicate();i.s=0-h.moveStart("character",-1e5),i.e=i.s+c.text.length,i.c=i.e}else try{i.s=e.selectionStart,i.e=e.selectionEnd,i.c=i.e}catch(d){}return!i.s&&i.s<0&&(i={s:0,e:0,c:0}),i},m.prototype.dispose=function(){this.input._arTracker=null,this.recorder=null,this.lastValue=null,this.input=null,this.lastCaretInfo=null,this._lastSelectListContents=null,clearTimeout(this._caretMonitor)};var y=function(e){this._elementCache={},this._callbackTimer=null,this.mutation=e,this.cacheIndex=0,e=null};y.prototype.dispose=function(){r.superDispose(this._elementCache),this._elementCache=null,this.mutation=null,clearTimeout(this._callbackTimer)},y.prototype.push=function(e,t,i,n){var o={t:e,c:t,i:i,p:n,d:r.now()};n=n||"",e&&1!=e.nodeType&&(e=e.parentNode),e&&this._elementCache&&(e._arKey||(e._arKey={id:"_"+this.cacheIndex++}),this._elementCache[e._arKey.id+n.toLowerCase()]=o,this._callbackTimer||(this._callbackTimer=setTimeout(function(e){return function(){e.handleEvents()}}(this),1500)),e=null,t=null)},y.prototype.handleEvents=function(){this._callbackTimer=null;try{this.mutation.getDocument()}catch(e){return}var t=this._elementCache,i=r.now();for(var n in t){var o=t[n];o._arKey=null,"object"==typeof o&&o.t&&o.t.nodeName&&"svg"!=o.t.nodeName&&(o.c(i-o.d),r.superDispose(o),o=null)}this.mutation.elementsProcessed(),r.superDispose(this._elementCache),this._elementCache={},t=null};var _=function(e){this.recorder=e,this.domMethodCopies=[],this.domMethodRewrites=[],this.domUpdateThrottler=new y(this),this.elementsUpdated=new r.AurycEvent,this.hasDomUpdate=!1,this.hasNodeBindingsUpdate=!1,this.customDataDefs=[],this.supportsDomPrototypes=!C._browser.isIE||(r.isDefined(e.win.Element)||r.isDefined(e.win.HTMLElement))&&!r.getConfig("useEleMutation","record"),this.setupCustomConfig(),this.setupMutationObserver(this.recorder,this)||(C._browser.isIE&&(this.saveDomMuationMethods(),this.supportsDomPrototypes&&this.overrideDomPrototype(),this.setNodeSpecificBindings(this.recorder.win.document),this.recorder.DomUpdated.subscribe(r.proxy(function(e){this.setNodeSpecificBindings(e),e=null},this))),"Chrome,Safari".indexOf(C._browser.browser.name)>=0&&(this.webkitWatcher=new C.WebkitWatcher(e)),C._browser.isIE||(r.BindOnce(e.win.document,"record:DOMSubtreeModified",this.domSubtreeModifiedHandler(this.recorder,this)),r.BindOnce(e.win.document,"record:DOMAttrModified",this.domAttrModifiedHandler(this.recorder,this)))),e=null};_.mutatorInfo={ignoreNodeContentsList:"input,select,img,link,meta,title,textarea,br,hr,script".split(","),watchNodeList:"html,head,header,h1,h2,h3,h4,h5,article,aside,section,details,footer,figure,nav,body,div,span,ul,li,dd,dt,ol,dl,tr,td,span,form,img,a,area,iframe,fieldset,select,input,textarea,table,label",svgWatchNodeList:"svg,defs,g,symbol,use,circle,ellipse,line,polygon,polyline,rect,linearGradient,radialGradient,animate,animateColor,animateMotion,animateTransform,set,stop,a,altGlyphDef,clipPath,color-profile,cursor,filter,font,font-face,foreignObject,image,marker,mask,pattern,switch,text,view,path,clippath",domRewriteList:"appendChild,removeChild,removeNode,insertAdjacentHTML,replaceChild,replaceNode,swapNode,insertBefore".split(",")};var T=_.mutatorInfo;_.prototype.setupMutationObserver=function(e,t){var r=window.MutationObserver?"MutationObserver":!!window.WebKitMutationObserver&&"WebKitMutationObserver";if(r)return t.mutationObserver=new window[r](function(r){r.forEach(function(r){var i;switch(r.type){case"attributes":i={target:r.target,attrName:r.attributeName,newValue:r.target.getAttribute(r.attributeName)},t.domAttrModifiedHandler(e,t)(i),i=null;break;case"characterData":if(3==r.target.nodeType){r.target.parentNode;i={target:r.target},t.domSubtreeModifiedHandler(e,t)(i),i=null}break;case"childList":i={target:r.target},t.domSubtreeModifiedHandler(e,t)(i),i=null}})}),this.mutationConfig={attributes:!0,childList:!0,subtree:!0,characterData:!0},t.mutationObserver.observe(e.win.document,this.mutationConfig),!0},_.prototype.setupCustomConfig=function(){var e=this,t=r.getConfig("userProperties","behavior");t&&(e.customDataDefs=t)},_.prototype.propertyChangeHandler=function(e){var t=function(e,t){return!(!e||"_"==e.substr(0,1)||"on"==e.substr(0,2)||"script,meta,title".indexOf(t)>=0)&&(0!==e.indexOf("siz")&&0!==e.indexOf("jQuery"))},i=e.propertyName,n=e.srcElement;if(!t(i,n.tagName))return n=null,void(e=null);if("innerHTML"==i||"innerText"==i||"outerHTML"==i)("outerHTML"==i||n.tagName&&"select"==n.tagName.toLowerCase())&&(n=n.parentNode),this.domUpdateThrottler.push(n,function(e,t){return function(i){var n=L._tagDynamicMaskNodes(t,!1,e.recorder.win),o=E.getMapping(t),s=e.recorder.getLogger();r.getConfig("IECSSText","record")&&x.externalizeStyleCSSTextToInnerHTML(t),s&&(s.log(e.recorder,D.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:s.logXPath(e.recorder,o),h:v.ProcessHTML(t.innerHTML,e.recorder.win.document,o,n)},null,i),e._handleDomUpdateIfNecessary(t)),t=null,e=null,n=null}}(this,n),!1);else if("on"!=i.substring(0,2)){for(var o=0;o<T.domRewriteList.length;o++)if(i==T.domRewriteList[o])return;if("_"==i.substr(0,1)||"on"==i.substr(0,2).toLowerCase())return;var s=n[i];i.indexOf("style.")>-1&&(i="style",
s=n.getAttribute(i)),this.domUpdateThrottler.push(n,function(e,t){return function(n){if(L._tagDynamicMaskNodes(t,!1,e.win),"style"==i){var o=t.getAttribute("style")||t.style;o&&o.cssText&&(s=o.cssText)}var a=e.getLogger(),l=E.getMapping;if(a)if("style"==i){s&&"null"!=s||(s="");var c=a.logXPath(e,l(t,null,"id"==i)),h=t.getAttribute("style")||t.style;h&&a.log(e,D.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:i,v:"undefined"!=typeof h.cssText?h.cssText:h+"",x:c},null,n)}else{var d=t.tagName&&t.tagName.toLowerCase();"object"==typeof s||"value"==i&&"input"==d&&"hidden"==t.type||r.inArray(d,["input","select","textarea"])&&!r.inArray(i,["className","cols","rows","class","width","height","align"])||a.log(e,D.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:i,v:s+"",x:a.logXPath(e,l(t,null,"id"==i))},null,n)}e=null,a=null,t=null}}(this.recorder,n),!0,i)}t=null,n=null,e=null},_.prototype.domSubtreeModifiedHandler=function(e,t){return function(e){var i=e.originalTarget||e.target||e.srcElement,n=i.tagName?i.tagName.toLowerCase():"";if(r.inArray(n,T.ignoreNodeContentsList))"select"==n&&i._arTracker&&t.domUpdateThrottler.push(i,function(e){return function(){e._arTracker.serialize()}}(i));else{if(r.getConfig("svgCaptureEnabled","record")&&r.inArray(n,T.svgWatchNodeList.split(","))){for(var o=i;!o.innerHTML&&o.parentNode;)o=o.parentNode;i=o}var s;t.customDataDefs.length&&r.collectCustomData(t.customDataDefs,!0,i),t.domUpdateThrottler.push(i,function(e,t,r){return function(r){t._doDomUpdateWorkWithLog(e,r)}}(i,t,s))}}},_.prototype.domAttrModifiedHandler=function(e,t){return function(i){var n=i.attrName,o=i.newValue,s=i.originalTarget||i.target||i.srcElement;"on"==n.substr(0,2)||"script,meta,title".indexOf(s.tagName)>=0||(t.domUpdateThrottler.push(s,function(t){return function(i){var s,a=e.getLogger(),l=E.getMapping;if(a)if("class"==n&&L._tagDynamicMaskNodes(t,!0,e.win),"style"==n){s=a.logXPath(e,l(t,null,"id"==n));var c=t.getAttribute("style")||t.style;c&&a.log(e,D.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:n,v:"undefined"!=typeof c.cssText?c.cssText:c+"",x:s},null,i)}else if(("value"!=n||!t.tagName||"input"!=t.tagName.toLowerCase()||"hidden"!=t.type)&&"on"!=n.substr(0,2).toLowerCase()){if(s=a.logXPath(e,l(t,null,"id"==n)),"value"==n&&t.tagName&&"input"==t.tagName.toLowerCase()){var h=t.getAttribute("class")||t["class"];r.isDefined(h)&&(h.indexOf("arHidden")>-1||h.indexOf("arObsecure")>-1)&&(o=o.replace(/[\w\d\s]/g,"*"))}a.log(e,D.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:n,v:o,x:s},null,i)}}}(s,n),!0,n),s=null)}},_.prototype._doDomUpdateWorkWithLog=function(e,t){var i=this.recorder;3==e.nodeType&&(e=e.parentNode);var n=E.getMapping(e);if(0===n[0].indexOf("html")){var o=L._tagDynamicMaskNodes(e,!1,i.win);r.getConfig("IECSSText","record")&&x.externalizeStyleCSSTextToInnerHTML(e);var s=e.innerHTML?v.ProcessHTML(e.innerHTML,i.win.document,n,o):{},a=i.getLogger();a&&(a.log(i,D.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:a.logXPath(i,n),h:s},null,t),this._handleDomUpdateIfNecessary(e))}},_.prototype._handleDomUpdateIfNecessary=function(e){var t=e.tagName?e.tagName.toLowerCase():"";1!=e.nodeType||r.inArray(t,_.ignoreNodeContentsList)||this.recorder.DomUpdated.fire(e),this.setDomUpdated()},_.prototype.setNodeSpecificBindings=function(){this.setNodeBindingsUpdated()},_.prototype.updateNodeSpecificBindings=function(){for(var e=h(T.watchNodeList+", "+T.svgWatchNodeList),t=function(e){return function(t){e.propertyChangeHandler(t)}}(this),i=e.length-1;i>=0;i--){var n=e[i];if(r.BindOnce(n,"record:propertychange",t,!0,!0),!this.supportsDomPrototypes){var o,s=n.getAttribute("_arRewrite");if(!s){n.setAttribute("_arRewrite","true");for(var a=T.domRewriteList.length-1;a>=0;a--)o=T.domRewriteList[a],n[o]=this.domMethodRewrites[o]}}n=null}e=null,node=null,t=null},_.prototype.methodRewriter=function(e,t){return function(){var i=this.parentNode,n=t.domMethodCopies[e];if(n){var o;if("BODY"==this.tagName)try{o=n(arguments[0],arguments[1])}catch(s){o=n.apply(this,arguments)}else if("IE"==C._browser.browser.name&&7==C._browser.browser.version)try{o=n.apply(this,arguments)}catch(s){try{o=n.call(this,arguments[0],arguments[1])}catch(a){o=n(arguments[0],arguments[1])}}else o=n.apply(this,arguments);return i&&1==i.nodeType&&t.domUpdateThrottler.push(i,function(e,t){return function(i){var n=L._tagDynamicMaskNodes(t,!1,e.recorder.win);r.getConfig("IECSSText","record")&&x.externalizeStyleCSSTextToInnerHTML(t);var o=E.getMapping(t),s=e.recorder.getLogger();if(s){var a=t.tagName?t.tagName.toLowerCase():"";if(r.getConfig("svgCaptureEnabled","record")&&r.inArray(a,T.svgWatchNodeList.split(","))){for(var l=t;!l.innerHTML;){if(!l.parentNode)return;l=l.parentNode}t=l}s.log(e.recorder,D.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:s.logXPath(e.recorder,o),h:v.ProcessHTML(t.innerHTML,e.recorder.win.document,o,n)},null,i),e._handleDomUpdateIfNecessary(t)}t=null,e=null,n=null}}(t,i),!1),o}}},_.prototype.saveDomMuationMethods=function(){for(var e,t=T.domRewriteList.length-1;t>=0;t--)e=T.domRewriteList[t],this.domMethodCopies[e]=this.recorder.win.document.body[e],this.domMethodRewrites[e]=this.methodRewriter(e,this)},_.prototype.overrideDomPrototype=function(){for(var e,t=this.recorder.win,i=r.isDefined(t.Element)?t.Element.prototype:void 0,n=r.isDefined(t.HTMLElement)?t.HTMLElement.prototype:void 0,o=T.domRewriteList.length-1;o>=0;o--)e=T.domRewriteList[o],i&&(i[e]+"").indexOf("native")>-1&&(i[e]=this.domMethodRewrites[e]),n&&(n[e]+"").indexOf("native")>-1&&(n[e]=this.domMethodRewrites[e])},_.prototype.removeDomPrototypeOverrides=function(){for(var e,t=this.recorder.win,i=r.isDefined(t.Element)?t.Element.prototype:void 0,n=r.isDefined(t.HTMLElement)?t.HTMLElement.prototype:void 0,o=T.domRewriteList.length-1;o>=0;o--)e=T.domRewriteList[o],i&&i[e]&&delete i[e],n&&n[e]&&delete n[e]},_.prototype.dispose=function(){r.superDispose(this.domMethodCopies),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.supportsDomPrototypes&&C._browser.isIE&&this.removeDomPrototypeOverrides(),this.domMethodCopies=null,this.domMethodRewrites=null,this.domUpdateThrottler.dispose(),this.webkitWatcher&&this.webkitWatcher.dispose(),this.recorder=null,this.elementsUpdated.unsubscribeAll(),this.elementsUpdated=null},_.prototype.getDocument=function(){return this.recorder&&this.recorder.win.document},_.prototype.setDomUpdated=function(){this.hasDomUpdate=!0},_.prototype.setNodeBindingsUpdated=function(){this.hasNodeBindingsUpdate=!0},_.prototype.elementsProcessed=function(){this.hasDomUpdate&&(this.hasDomUpdate=!1,this.elementsUpdated.fire()),this.hasNodeBindingsUpdate&&(this.hasNodeBindingsUpdate=!1,this.updateNodeSpecificBindings())};var v=function(e,t){var r=v,i=e.document;return r.ProcessHTML(r._getDocType(i)+i.querySelectorAll("html")[0].outerHTML,i,t,!1)},w=v;v.ProcessHTML=function(e,t,r,i){var n=v;if(C._browser.isIE){var o;o=t.querySelectorAll("object");for(var s=0;s<o.length;s++)e=n._fixObjectTag(e,o[s])}return b.getCacheableObject(n._scrubHTML(e,i),r)},v._scrubHTML=function(e,t){var i=v;if(e=e instanceof Array?e[0]:e||"",r.getConfig("regexScrub","record"))for(var n=0;n<r.getConfig("regexScrub","record").length;n++)e=e.replace(r.getConfig("regexScrub","record")[n],"");r.isDefined(r.getConfig("keepComments","record"))&&r.getConfig("keepComments","record")===!0||(e=i._removeComments(e)),e=i._removeInnerScriptContent(e),e=i._removeZeroWidthEntities(e),e=i._fixPreTags(e),e=i._fixViewState(e),e=i._convertSpecialChars(e);var o=!1;return r.isDefined(r.getConfig("keepInputs","record"))&&r.getConfig("keepInputs","record")===!0||(o=!0),e=i._stripOptionTags(e,o),e=i._stripInputValues(e,o),e=i._maskARHiddenBlocks(e,t)},v._removeComments=function(e){return/<!--/gim.test(e)?w._superReplace(e,/(<!--)[\w\W]*?(-->)/gim,function(e){return e[0].indexOf("arHiddenBlock")<0?"":e[0]}):e},v._convertSpecialChars=function(e){var t=r.getConfig("specialMappings","record");if(r.isDefined(t))for(var i=0,n=t.length;i<n;i++)e=e.replace(t[i][0],t[i][1]);return e},v._removeInnerScriptContent=function(e){return/script/gim.test(e)?w._superReplace(e,/(<script[^>]*?>)[\s\S]*?(<\/[\w]*script>)/gim,function(e){return e[1]+e[2]}):e},v._maskARHiddenBlocks=function(e,t){return t?this._superReplace(e,new RegExp(".+","mig"),w._maskBlock):e.indexOf("arHiddenBlock")>=0?v._superReplace(e,new RegExp("<!--(\\W)*arHiddenBlockStart[\\w\\W]*?arHiddenBlockEnd(\\W)*-->","mig"),w._maskBlock):e},v._removeZeroWidthEntities=function(e){return e.replace(/(\u200B)|(\u200C)|(\u200D)|(\uFEFF)/g,"")},v._fixPreTags=function(e){return e.indexOf("/pre")>-1||e.indexOf("/PRE")>-1?w._superReplace(e,new RegExp("[\\s\\S]*?(?:\\/pre\\s*>)|[\\s\\S]+","mig"),w._removeFormat):e},v._fixViewState=function(e){return e.indexOf("VIEWSTATE")>-1?e.replace(/<input[^>]*name=["']?__VIEWSTATE[^>]*>/gim,'<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" />'):e},v._stripOptionTags=function(e,t){return/select/gim.test(e)?w._superReplace(e,/(<select[^>]*>)[\s\S]*?(<\/[\w]*select>)/gim,function(e){if(t||e[1]&&(e[1].indexOf("arHidden")>-1||e[1].indexOf("arObsecure")>-1)){var r=e[0].match(/<select[^>]*>/gim);return e[0].substr(0,e[0].lastIndexOf(r[r.length-1]))+r[r.length-1]+e[2]}return e[0]}):e},v._stripInputValues=function(e,t){if(e.length>0&&/value/.test(e)){var r=function(e,r,i){if(r)return t?r+i.replace(/[\w\d\s]/g,"*")+'"':r.indexOf("arHidden")>-1||r.indexOf("arObsecure")>-1?r+i.replace(/[\w\d\s]/g,"*")+'"':r+i+'"'};return e.replace(/(<(?:\s)*?input(?:[^>]+)value=\")([^>\"]*)\"/gim,r)}return e},v._fixObjectTag=function(e,t){var r=t.id,i=new RegExp("(<object[^>]*id=['\"]?"+r+"['\"]?.*?>)([\\s\\S]*?)(</object>)","im");return e.replace(i,function(e,r,i,n){for(var o="",s="",a=0;a<t.childNodes.length;a++){var l=t.childNodes[a];"PARAM"==l.tagName?o+=l.outerHTML:s+=l.outerHTML}return r+o+s+n})},v._superReplace=function(e,t,i){for(var n,o=t.exec(e),s="",a=0;r.isDefined(o);)s+=e.substring(a,o.index),n=i(o),s+=n,a=o.index+o[0].length,o=t.exec(e);return s+=e.substring(a,e.length)},v._maskBlock=function(e){var t=e instanceof Array?e[0]:e||"";if(t.length>0){var r=function(e,t,r,i){return r||i||"*"};return t.replace(/(>)|(&[^\s;]*;)|(<[^<>]*?>)|(<)|\w/g,r).replace(/&((?!nbsp| |amp).)*?;/g,"*")}return""},v._removeFormat=function(e){var t=0,r=e[0];return r&&(r="",t=v._regexIndexOf(e[0],new RegExp("<\\s*?pre","mig")),r+=e[0].substring(0,t).replace(/\t/g," ").replace(/\s+/g," "),r+=e[0].substring(t)),r},v._regexIndexOf=function(e,t,r){var i=e.substring(r||0).search(t);return i>=0?i+(r||0):i},v._regexLastIndexOf=function(e,t,r){for(var i=r,n=v.regexIndexOf(e,t,i);n>-1;)i=n,n=v.regexIndexOf(e,t,i+1);return i},v._getDocType=function(e){var t="";if(C._browser.isIE&&("CSS1Compat"!=e.compatMode||5==e.documentMode))return t;var i=e.doctype;if(i)t="<!DOCTYPE HTML",i.publicId&&(t=t+' PUBLIC "'+i.publicId+'"'),i.systemId&&(t=t+' "'+i.systemId+'"'),t+=">";else{var n=e.childNodes,o=0;if(n[o].text){for(;n[o].text&&(0===n[o].text.indexOf("<!--")||0===n[o].text.indexOf("<?xml"));)o++;r.isDefined(n[o].text)&&0===n[o].text.toLowerCase().indexOf("<!doctype")&&(t=n[o].text)}}return t};var S=function(e){this.recorder=e,this.nodeList=[],this.watchProperties="src,style,id,class".split(","),this.nodeWatchList=_.mutatorInfo.watchNodeList+",iframe,button,textarea",r.getConfig("svgCaptureEnabled","record")&&(this.nodeWatchList+=_.mutatorInfo.svgWatchNodeList,this.watchProperties=this.watchProperties.concat("x,y,width,height,viewBox,preserveAspectRatio,zoomAndPan,baseProfile,contentScriptType,contentStyleType,alignment-baseline,baseline-shift,clip,clip-path,clip-rule,color,color-interpolation,color-interpolation-filters,color-profile,color-rendering,cursor,direction,display,dominant-baseline,enable-background,fill,fill-opacity,fill-rule,filter,flood-color,flood-opacity,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,glyph-orientation-horizontal,glyph-orientation-vertical,image-rendering,kerning,letter-spacing,lighting-color,marker-end,marker-mid,marker-start,mask,opacity,overflow,pointer-events,shape-rendering,stop-color,stop-opacity,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,text-anchor,text-decoration,text-rendering,unicode-bidi,visibility,word-spacing,writing-mode,xlink:href, xlink:show, xlink:actuate, xlink:type, xlink:role, xlink:arcrole, xlink:title, x1, x2, y1, y2, gradientUnits, gradientTransform, spreadMethod, cx, cy, r, fx, fy, local, name, rendering-intent, filterRes, filterUnits, primitiveUnits, horiz-origin-x, horiz-origin-y, horiz-adv-x, vert-origin-x, vert-origin-y, vert-adv-y, font-family,font-style,font-variant,font-weight,font-stretch,font-size,unicode-range,units-per-em,panose-1,stemv,stemh,slope,cap-height,x-height,accent-height,ascent,descent,widths,bbox,ideographic,alphabetic,mathematical,hanging,v-ideographic,v-alphabetic,v-mathematical,v-hanging,underline-position,underline-thickness,strikethrough-position,strikethrough-thickness,overline-position,overline-thickness, transform, refX, refY, markerUnits, markerWidth, markerHeight, orient, refX, refY, markerUnits, markerWidth, markerHeight, maskUnits, maskContentUnits, patternUnits, patternContentUnits, patternTransform, lengthAdjust, dx, dy, rotate, textLength, viewTarget".split(","))),this._bindToNodes(e.win.document),e.DomUpdated.subscribe(function(e){return function(t){t.childNodes.length>0&&e._bindToNodes(t)}}(this)),this._checkProperties()};S.prototype._checkProperties=function(e){for(var t=new Date,i=0;i<this.nodeList.length;i++){var n=this.nodeList[i];if(n.node){var o={propertyState:this._getPropertyState(n.node),node:n.node},s=this._stateDiffs(n.propertyState,o.propertyState);if(!s)continue;if(difauryc.length>0){for(var a=0;a<difauryc.length;a++){var l;"class"==s[a].attr.toLowerCase()&&s[a].val.indexOf("ar")==-1&&L._tagDynamicMaskNodes(n.node,!0,this.recorder.win),l="id"==s[a].attr.toLowerCase()?E.getMapping(n.node,[],!0):E.getMapping(n.node),0===l[0].indexOf("html")&&this.recorder.getLogger().log(this.recorder,D.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:s[a].attr,v:s[a].val,x:this.recorder.getLogger().logXPath(this.recorder,l)})}n.propertyState=o.propertyState}}else this.nodeList.splice(i--,1)}var c=new Date-t,h=500;c>150&&(h=750),c>500&&(h=2e3),c>1e3&&(h=1e4),e||(this.nodeWatchTimer=setTimeout(r.proxy(function(){this._checkProperties()},this),h))},S.prototype._getPropertyState=function(e){for(var t={},i=0;i<this.watchProperties.length;i++){var n=e.getAttribute(this.watchProperties[i]);r.isDefined(n)&&(t[this.watchProperties[i]]=n.toString())}return t},S.prototype._stateDiffs=function(e,t){for(var i=[],n=0;n<this.watchProperties.length;n++){var o=this.watchProperties[n],s=r.isDefined(e[o]),a=r.isDefined(t[o]);s&&a?e[o].toString()!=t[o].toString()&&(i[difauryc.length]={attr:o,val:t[o]||""}):(!s&&a||s&&!a)&&(i[difauryc.length]={attr:o,val:t[o]||""})}return i},S.prototype._bindToNodes=function(e){var t,r=h(this.nodeWatchList,e);if(e.documentElement){var i=[];for(t=0;t<r.length;t++)i.push(r[t]);i.push(e.documentElement),r=i}for(t=0;t<r.length;t++){for(var n=r[t],o={propertyState:this._getPropertyState(n),node:n},s={node:null},a=0;a<this.nodeList.length;a++)if(this.nodeList[a].node==n){s=this.nodeList[a];break}s.node!=n?this.nodeList[this.nodeList.length]=o:s.propertyState=o.propertyState}},S.prototype.dispose=function(){clearTimeout(this.nodeWatchTimer)};var E={};E._nodeCache={},E.getMapping=function(e,t,r){if(t=t||[],e.parentNode&&(t=E.getMapping(e.parentNode,t)),1==e.nodeType){var i,n;if(e.previousSibling){i=1,n=e.previousSibling;do 1==n.nodeType&&n.nodeName==e.nodeName&&i++,n=n.previousSibling;while(n);1==i&&(i=null)}else if(e.nextSibling){n=e.nextSibling;do 1==n.nodeType&&n.nodeName==e.nodeName?(i=1,n=null):(i=null,n=n.previousSibling);while(n)}t.push(e.nodeName.toLowerCase()+(e.getAttribute&&e.getAttribute("id")&&!r?"[@id='"+e.getAttribute("id")+"']["+(i||1)+"]":i>0?"["+i+"]":""))}return t},E.invalidateXPathCacheForNode=function(e){for(var t in E._nodeCache)t.length>e.length&&t.substr(0,e.length)==e&&delete E._nodeCache[t]},E.getNode=function(e,t){var r=function(e,t){t=t.toLowerCase();var r=[];if(e){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];n.tagName&&n.tagName.toLowerCase()==t?r[r.length]=n:"#text"==t&&3==n.nodeType&&(r[r.length]=n)}return r}},i=function(e,t,r,i){if(e){var n,o,s,a=e.childNodes,l=0;for(n=0;n<a.length;n++)if(o=a[n],1==o.nodeType&&o.tagName&&o.tagName.toLowerCase()==t){if(s=o.getAttribute?o.getAttribute("id"):o.id,s==r&&l+1>=i)return o;l++}for(a=e.childNodes,n=0;n<a.length;n++)if(o=a[n],1==o.nodeType&&o.tagName&&o.tagName.toLowerCase()==t&&(s=o.getAttribute?o.getAttribute("id"):o.id,s==r))return o}};if(E._nodeCache[e]&&E._nodeCache[e].parentNode&&t==window.document)return E._nodeCache[e];for(var n=e.split(","),o=t,s=0;s<n.length;++s){var a=1;if(n[s].indexOf("[")!=-1&&n[s].indexOf("]")!=-1)if(a=n[s].split("[")[1].split("]")[0],a.indexOf("@id=")>-1){var l=n[s].split("["),c=l[0],h=parseInt(l[2].replace("]",""));a=a.replace("@id='","").replace("'",""),o=i(o,c,a,h)}else{var d=n[s].split("[")[0],u=r(o,d);u&&(o=u[parseInt(a)-1])}else{var g=o,p=r(o,n[s]);p&&(o=p[a-1]),!o&&g&&(o=g.getElementsByTagName(n[s])[a-1])}}return t==window.document&&(E._nodeCache[e]=o),o};var b={_browser:null,_cacheList:[]};b.reset=function(e){b._browser=e,b._cacheList=[]},b.getCacheableObject=function(e,t){var i=b._browser.isMobile;t&&t.join&&(t=t.join(","));var n,o={},s=b,a=s._cacheList;for(n=a.length-1;n>=0;n--)if(a[n].str==e){o.uid=a[n].uid;break}if(!r.isDefined(o.uid)){if(o.uid=r.generateGUID(),o.kl=t,t&&e.length>100)for(n=a.length-1;n>=0;n--)if(a[n].kl==t){var l=N(a[n].str,e);o.diff={uid:a[n].uid,d:l};break}r.isDefined(o.diff)?(!i||a.length<500)&&(a[a.length]={str:e,uid:o.uid,kl:o.kl}):(o.str=e,(!i||a.length<500)&&(a[a.length]=o))}return o};var C=function(e,t){this.browser=t,this.isTop=e.getTop()==e,this.recorder=e,this.mutation=new _(e),this.mobileCapture=r.initMobile(e.win.document),this._setupMouseTracking(this.mobileCapture),this.sizeCapture=new g(this.recorder,this.recorder.win,"resize",700,function(e,i,n){var o=r.GetSize(n.win),s=0,a=n.getLogger(),l=x.getDocSize(n.doc),c={w:l.width,h:l.height};if(n.docSize=l,t.isMobile){var h=o;o=c,c=h,s=window.orientation}o.w>0&&o.h>0&&c.w>0&&c.h>0&&a.log(n,D.EVENT_TYPES.FRAME_SIZE,{sz:o,avs:c,st:s,m:t.isMobile},null,-350),l.width>0&&l.height>0&&a.log(n,D.EVENT_TYPES.DOC_SIZE,{sz:{w:l.width,h:l.height}},null,-340)});var i=this.recorder.win.onerror;this.recorder.win.onerror=r.proxy(function(e,t,r){e&&t&&this.getLogger().log(this,D.EVENT_TYPES.JAVASCRIPT_ERROR,{v:e+", "+t+", "+r}),i&&i.apply(this.win,arguments)},this.recorder),this.inputCaptures=[],this.pinchEventArr=[],this.updateNodeBinding(this.recorder.win.document.body,!1,!0),this.inputReserialize=function(e,t,i){return function(){setTimeout(function(){try{e.recorder.win.document}catch(t){return}for(var n=0;n<i.length;n++){var o=i[n];i[n].hasChanged()&&r.isDefined(o.input)&&"SELECT"!=o.input.nodeName&&(o.lastValue=o.input.value,o.serialize())}},100),e.isTop||e.recorder.getTop().eventcap.inputReserialize.apply()}}(this,this.recorder,this.inputCaptures),r.Bind(this.recorder.win.document,"record:click",this.inputReserialize),r.isDefined(r.getConfig("scrollEls","record"))&&(this._setupScrollTracking(this.recorder.win.document),e.DomUpdated.subscribe(r.proxy(function(e){this._setupScrollTracking(e)},this)));var n=this;r.SubPub.subscribe(r.SYMBOLS.EVENT.CLICKTRIGGER,function(e){var t=n._getPosition(e),r=e.explicitOriginalTarget||e.originalTarget||e.target||e.srcElement,i=0;r&&(i=n.recorder.getLogger().logXPath(n.recorder,E.getMapping(r))),n.browser.isMobile?n.recorder.getLogger().log(n.recorder,D.EVENT_TYPES.TAP,{ps:t,x:i,a:e.elText,d:1,ag:"0.00",p:"touch",s:"0.00"},null,null,e.currentTime):n.recorder.getLogger().log(n.recorder,D.EVENT_TYPES.MOUSE_CLICK,{ps:t,x:i,a:e.elText},null,null,e.currentTime)}),e=null};C.prototype._setupScrollTracking=function(e){for(var t=e.querySelectorAll(r.getConfig("scrollEls","record")),i=function(e){return function(t,r){r||(r=t.target||t.srcElement),r&&e.getLogger().log(e,D.EVENT_TYPES.SCROLL_EL,{x:e.getLogger().logXPath(e,E.getMapping(r)),ps:{x:r.scrollLeft,y:r.scrollTop}})}},n=0;n<t.length;n++)t[n]._arScrollCapture||(t[n]._arScrollCapture=new g(this.recorder,t[n],"scroll",400,i(this.recorder)))},C.prototype._getMobileEvtType=function(e){switch(e){case"tap":return D.EVENT_TYPES.TAP;case"press":return D.EVENT_TYPES.PRESS;case"swipe":return D.EVENT_TYPES.SWIPE;case"pan":return D.EVENT_TYPES.SWIPE;case"pinch":return D.EVENT_TYPES.PINCH;default:return null}},C.prototype._resizeCapture=function(e){var t=r.GetSize(e.win),i=0,n=e.getLogger(),o=x.getDocSize(e.doc),s={w:o.width,h:o.height};e.docSize=o;var a=t;t=s,s=a,i=window.orientation,t.w>0&&t.h>0&&s.w>0&&s.h>0&&n.log(e,D.EVENT_TYPES.FRAME_SIZE,{sz:t,avs:s,st:i,m:!0},null,-350),o.width>0&&o.height>0&&n.log(e,D.EVENT_TYPES.DOC_SIZE,{sz:{w:o.width,h:o.height}},null,-340);var l={cw:window.innerWidth,ch:window.innerHeight,w:o.width,h:o.height},c={z:l,ps:r.GetScroll(e.win)};recordScrollEvent=!1,n.log(e,D.EVENT_TYPES.ZOOM,c)},C.prototype._captureMobileEvent=function(e,t){var i=r.GetScroll(e.win),n=e.win.frameElement,o=(x.getPositionRelativeToMainView(n,x.getParentWindow(n),!1),{x:t.center.x,y:t.center.y});r._.console.log(t);var s=JSON.parse(r.globalSessionTracker.getWinSize()),a=r.GetSize(e.win);if("pinchin"===t.type||"pinchout"===t.type)t.type="pinch";else if("pan"===t.type)0===o.x&&0===o.y?(o.x=x.getPosition(t.target,e.win).x,o.y=x.getPosition(t.target,e.win).y,o.x<a.w/4&&(o.x=a.w/2)):(o.x+=i.x,o.y+=i.y);else{var l=a.w/s.w,c=a.h/s.h;o.x+=i.x*l,o.y+=i.y*c}var h=this._getMobileEvtType(t.type);if(!h)return r._.console.log("Unknown type: "+h),null;if(!o||0!==o.x&&!o.x||0!==o.y&&!o.y)return r._.console.log("Bad position object, ",o),null;var d="";h===D.EVENT_TYPES.PINCH&&(d="pinchin"===t.additionalEvent?0:1,this._resizeCapture(e));var u=-1;t.target&&(u=e.getLogger().logXPath(e,E.getMapping(t.target)));var g={e:d,ps:o,d:t.direction,ag:t.angle.toFixed(2),s:t.distance.toFixed(2),x:u,a:this.getClickTargetText(e,t.srcEvent),p:t.pointerType};r._.console.log("mobile data:"+h),r._.console.log(g),e.getLogger().log(e,h,g)},C.prototype._getPosition=function(e){var t={x:"unknown"!=typeof e.clientX?e.clientX:"unknown"!=typeof e.screenX?e.screenX:e.sX,y:"unknown"!=typeof e.clientY?e.clientY:"unknown"!=typeof e.screenY?e.screenY:e.sY},i=r.GetScroll(this.recorder.win);"undefined"==typeof t.x&&(t=this.recorder.lastRawMouseCoords);var n={};if(r.isDefined(t)&&(this.recorder.lastRawMouseCoords=t,n={x:i.x+t.x,y:i.y+t.y},this.recorder.win!=this.recorder.win.top)){var o=this.recorder.win.frameElement,s=x.getPositionRelativeToMainView(o,x.getParentWindow(o),!1);s&&(n.x+=s.x-i.x,n.y+=s.y-i.y)}return n},C.prototype._setupMouseTracking=function(e){var t=this,i=function(e,i,n,o){var s=D.EVENT_TYPES;if(e.delayed||n.getTop().isMousedOverWindow||(n.getLogger().log(n,s.WINDOW_MOUSEOUT_MOUSEENTER,{st:1}),n.getTop().isMousedOverWindow=!0),n.getTop().isMousedOverWindow){o=o||s.MOUSE_MOVE;var a={x:"unknown"!=typeof e.clientX?e.clientX:"unknown"!=typeof e.screenX?e.screenX:e.sX,y:"unknown"!=typeof e.clientY?e.clientY:"unknown"!=typeof e.screenY?e.screenY:e.sY},l=-1,c="";o!=s.MOUSE_CLICK&&o!=s.MOUSE_DOWN||(c=t.getClickTargetText(n,e));var h=e.explicitOriginalTarget||e.originalTarget||e.target||e.srcElement;h&&(l=n.getLogger().logXPath(n,E.getMapping(h)));var d=r.GetScroll(this.recorder.win);if("undefined"==typeof a.x&&(a=n.lastRawMouseCoords),r.isDefined(a)){n.lastRawMouseCoords=a;var u={x:d.x+a.x,y:d.y+a.y};if(n.win!=n.win.top){var g=n.win.frameElement,p=x.getPositionRelativeToMainView(g,x.getParentWindow(g),!1);p&&(u.x+=p.x-d.x,u.y+=p.y-d.y)}o==s.MOUSE_CLICK||n.getLogger().log(n,o,{ps:u,x:l})}}},n=400;if(this.browser.isMobile){n=400,i=null,e.on("press",function(e){t._captureMobileEvent(t.recorder,e)}),e.on("pan",r.Lodash.throttle(function(e){t._captureMobileEvent(t.recorder,e)},n,{leading:!0,trailing:!1})),e.on("pinchstart pinchin pinchout",function(e){if("pinchstart"===e.type){var i=r.GetScroll(t.recorder.win);t.pinchEventArr=[],setTimeout(function(){o(i)},400)}t.pinchEventArr.push(e)});var o=function(e){var r=t.pinchEventArr.length,i=t.pinchEventArr[r-2],n="";n="pinchout"===i.additionalEvent?"pinchout":"pinchin",i=t.pinchEventArr[0],i.additionalEvent=n,i.center.x+=e.x,i.center.y+=e.y,t._captureMobileEvent(t.recorder,i),t.pinchEventArr=[]};this.isTop&&(this.lastOrientation={alpha:0,beta:0,gamma:0},r.Bind(window,"record:deviceorientation",function(e){return function(t){if(r.isDefined(t.alpha)){var i=Math.round(t.alpha),n=Math.round(t.beta),o=Math.round(t.gamma),s=10;if(Math.abs(i-e.lastOrientation.alpha)>s||Math.abs(n-e.lastOrientation.beta)>s||Math.abs(o-e.lastOrientation.gamma)>s){e.lastOrientation.alpha=i,e.lastOrientation.beta=n,e.lastOrientation.gamma=o;var a=e.recorder;a.getLogger().log(a,D.EVENT_TYPES.ORIENTATION,{ot:{a:i,b:n,g:o}})}}}}(this)),this.doOrientationChange=function(e){return function(t){var i=e.recorder.win.document.documentElement,n=x.getDocSize(e.recorder.doc),o=0;Math.abs(window.orientation)>0&&(o=1),e.recorder.getLogger().log(e.recorder,D.EVENT_TYPES.ORIENTATION_CHANGE,{ps:r.GetScroll(e.recorder.win),oc:{isL:o,ww:i.clientWidth,wh:i.clientHeight,dw:n.width,dh:n.height,wiw:window.innerWidth,wih:window.innerHeight}})}}(this),r.Bind(window,"record:orientationchange",this.doOrientationChange),this.doOrientationChange())}else{var s=this.browser.isIE?this.recorder.win.document:this.recorder.win;this.isTop?this.mouseMoveCapture=new g(this.recorder,s,"mousemove",250,i):this.mouseMoveCapture=this.recorder.getTop().eventcap.mouseMoveCapture.merge(this.recorder,s,"mousemove",i),r.Bind(this.recorder.win.document,"record:mousedown",function(e,t,r){return function(i){r.call(e,i,null,t,D.EVENT_TYPES.MOUSE_CLICK)}}(this,this.recorder,i))}if(this.scrollCapture=new g(this.recorder,this.recorder.win,"scroll",n,function(e){return function(t,n,o){var s=!0;if(o.win==o.win.top)if(b._browser.isMobile){var a=x.getDocSize(o.doc),l={cw:window.innerWidth,ch:window.innerHeight,w:a.width,h:a.height},c={z:l,ps:r.GetScroll(o.win)};s=!1,o.getLogger().log(o,D.EVENT_TYPES.ZOOM,c)}else i&&e.call(this,t,n,o);s&&o.getLogger().log(o,D.EVENT_TYPES.FRAME_SCROLL,{ps:r.GetScroll(o.win)})}}(i)),this.isTop){this.browser.isMobile||(this.recorder.isMousedOverWindow=!0,r.Bind(this.recorder.win.document,"record:mouseover",function(e,t){return function(e){!t||t.isMousedOverWindow||e.relatedTarget||e.fromElement||(t.getLogger().log(t,D.EVENT_TYPES.WINDOW_MOUSEOUT_MOUSEENTER,{st:1}),t.isMousedOverWindow=!0)}}(this,this.recorder)),r.Bind(this.recorder.win.document,"record:mouseout",function(e,t){return function(e){e=e?e:t.win.event;var r,i=e.relatedTarget||e.toElement;try{i&&(r=i.nodeName)}catch(n){}t&&t.isMousedOverWindow&&(!i||r&&"HTML"==r)&&(t.getLogger().log(t,D.EVENT_TYPES.WINDOW_MOUSEOUT_MOUSEENTER,{st:0}),t.isMousedOverWindow=!1,t.EmergencySendRequired.fire())}}(this,this.recorder)));var a=function(e){return function(){var t=x.getDocSize(e.doc);e.docSize&&e.docSize.width==t.width&&e.docSize.height==t.height||(e.docSize=t,e.getLogger().log(e,D.EVENT_TYPES.DOC_SIZE,{sz:{w:t.width,h:t.height}}))}}(this.recorder);a.apply(this,[]),this.mutation.elementsUpdated.subscribe(a),a=null}i=null},C.MAX_UPDATE_NODE_BINDING_EXECUTION_TIME=500,C.prototype.getClickTargetText=function(e,t){var i=t.explicitOriginalTarget||t.originalTarget||t.target||t.srcElement,n="";if(i){var o=r.isSecretEl(i);"password"===i.type?n='input[type="password"]':"select"===i.nodeName.toLowerCase()?n=i.name:"img"===i.nodeName.toLowerCase()&&(n=i.alt),n||o||(i.getAttribute&&i.getAttribute("data-text")&&!o&&(n=i.getAttribute("data-text")),n=n||i.value||i.textContent||i.innerText);var s=60;n?n=n.substring(0,s):(n=i.name||i.nodeName,n&&(n=n.toLowerCase(),i.type&&(n+='[type="'+i.type.toLowerCase()+'"]'))),n||(n=""),n=n.replace(/^\s+|\s+$/g,""),r._.console.log("elText: "+n)}return n},C.prototype.updateNodeBinding=function(e,t,i){for(var n=+new Date,o=e.querySelectorAll("input, select, textarea"),s=this.inputCaptures,a=function(e){return function(){setTimeout(r.proxy(function(){for(var e=0;e<this.length;e++)this[e].serialize()},e),1)}},l=o.length-1;l>=0;l--){if(r.now()-n>C.MAX_UPDATE_NODE_BINDING_EXECUTION_TIME){this.recorder.logger.log(this.recorder,D.EVENT_TYPES.INCOMPLETE_INPUT_CAPTURE,{});break}var c=o[l];if(c._arTracker)for(var h=s.length-1;h>=0;h--){var d=s[h];if(d.input==c&&d.hasChanged()){d.serialize();break}}else s[s.length]=new m(this.recorder,c),"reset"==c.getAttribute("type")&&r.Bind(c,"record:click",a(s));c=null}!i&&this.browser.isIE&&this.mutation.setNodeSpecificBindings(e,t),o=null,s=null,e=null},C.prototype.dispose=function(){this.mutation.dispose(),this.mutation=null,this.recorder=null,this.inputCaptures=null,this.inputReserialize=null;var e,t=u._trackers;for(e=0;e<t.length;e++)t[e].dispose(),t.splice(e--,1);var r=f;for(e=0;e<r.length;e++)r[e].dispose(),r.splice(e--,1)};var N=function(e,t){for(var r=e,i=t,n=e.length,o=t.length,s=n>o?o:n,a=s,l=0,c=0,h=0,d=0;a-l>15;)d=Math.round((a-l)/2),h=a-d,r.substr(0,h)!=i.substr(0,h)?a=h:l=h;var u=t.substr(l);for(a=u.length;a-c>15;)d=Math.round((a-c)/2),h=a-d,u.substr(u.length-h)!=r.substr(r.length-h)?a=h:c=h;return{o:l,c:c,r:t.substring(l,t.length-c)}},M=[],D=function(e,i,n){r._.console.log("logger constructed"),this.recorder=n,this.visitDuration=r.SYMBOLS.EVENT.VISIT_DURATION,this.heartbeatInterval=1e3*(r.getConfig("heartbeatInterval","behavior")||30),this.transmitInterval=1e3*(r.getConfig("transmitInterval","behavior")||15),this.mobileTransmitInterval=1e3*(r.getConfig("mobileTransmitInterval","behavior")||10),this.browser=i;var o=this;r.SubPub.subscribe(r.SYMBOLS.EVENT.PINGTRIGGER,function(){o._ping()});var s=[a.TRANSMIT_ENABLED,a.CANCELED,"pv"],l=e.get(s),c=!0,h=!1;l&&(c=l[a.TRANSMIT_ENABLED],h=l[a.CANCELED]);r.getScreenResolution();this.stg=e,this.pageViews=e.get("pv"),this.failCount=0,this.transportid=0,this.lastTransmissionTime=r.now()-1e4,r._.console.log("setting lastTransmissionTime: "+this.lastTransmissionTime),this.isTransmitting=!1,this.holdTransmits=!1,this.transmitEnabled=!1,this.cobrowsing=r.getConfig("cb","record")?1:0,this.canceled=!1,this.siteid=r.getConfig("siteid"),this.domain=document.domain.toString(),this.StorageReady=new r.AurycEvent,this.TransportReady=new r.AurycEvent,this._quickXpathCache={},this._reset(),this.lastIndex=0,this.eventContainer={},this.title=r.isObject(history.state)&&history.state&&history.state.title||document.title;var d=r.getVisibilityEventPrefix();document.addEventListener(d+"visibilitychange",r.proxy(function(){var e="hidden"===document[(""===d?"v":prefix+"V")+"isibilityState"],t=r.globalSessionTracker.getSessionMetadata().sessionId;this.log(this.recorder,this.getEventTypes().CUSTOM_BEHAVIOR,{a:"vc",v:JSON.stringify({o:t,n:!e,url:location.href,title:this.title})})},this));var u=r.canUseVisibilityChange(i.isMobile);if(u)document.addEventListener(d+"visibilitychange",r.proxy(function(){"hidden"===document[(""===d?"v":prefix+"V")+"isibilityState"]&&(r._.console.log("visibility hidden"),this.commitData(i.isMobile))},this));else{var g=i.isMobile?"unload":"beforeunload";window.addEventListener(g,r.proxy(function(){r._.console.log("befoerunload fires"),this.commitData(i.isMobile)},this))}r.isSafari()&&i.isMobile&&window.addEventListener("pagehide",r.proxy(function(){r._.console.log("unload fires"),this.commitData(!1)},this)),this._backup_storage=new r.DomStorage(this.siteid,(!1),(!1),i),this._storage=new r.WindowStorage(this.siteid,(!1),i),this._syncStorage(),this._syncSession(!!c,!!h),this._syncData(),this.startStateMonitor(),this.startStorageMonitor(),this.TransportReady.subscribe(r.proxy(function(){r._.console.warn("SR: transport ready"),this.StorageReady.fire(),this._flushAndTransmit()},this),!0,!0),
i.isIE&&i.browser.version<10?(r._.console.warn("SR: choosing flash for transport"),this.isAjax=!1,this.transport=new r.FlashTransport({url:t.makeURI("auryc_utils.swf")}),this.transport.initialize(r.proxy(function(){this.TransportReady.fire()},this))):(r._.console.warn("record choosing CORS for transport"),this.isAjax=!0,this.transport=new r.AjaxTransport,this.TransportReady.fire()),this.recorder.ready.subscribe(r.proxy(function(){r._.console.warn("SR: recorder is ready"),this.recorder.EmergencySendRequired.subscribe(r.proxy(function(){this._flushAndTransmit(!0)},this))},this),!0,!0),n=null};D.prototype.reSyncSession=function(){this._syncSession(!!this.transmitEnabled,!!this.canceled,!0)},D.prototype.logPageMarker=function(){var e=r.getScreenResolution(),t=r.globalSessionTracker.getPVStartTS();this.log(this.recorder,D.EVENT_TYPES.PAGE_MARKER,{dtm:t,ofs:(new Date).getTimezoneOffset(),v:this.browser.browser.name,dv:this.browser.browser.version,sid:r.getConfig("siteid"),r:"W3C",l:r.getConfig("layout","record")||"",m:this.browser.isMobile,a:this.browser.deviceType,f:document.referrer.toString(),sz:{w:e.w,h:e.h}},-1)},D.prototype.logVisibilityChange=function(e){var t=r.globalSessionTracker.getSessionMetadata().sessionId;this.log(this.recorder,D.EVENT_TYPES.CUSTOM_BEHAVIOR,{a:"vc",v:JSON.stringify({o:t,n:"beginSession",url:location.href,title:this.title})},null,null,e+50)},D.prototype.commitData=function(e){this._flush(),this.transmitEnabled&&this._transmit(e),this._storage&&(this._storage.set(a.SESSION,this._session),this._storage.setBlob(this._data),this._storage.commit()),this._backup_storage&&(this._backup_storage.set(a.SESSION,this._session),this._backup_storage.setBlob(this._data),this._backup_storage.commit())},D.prototype.dispose=function(){this._flush(),this.transport.dispose&&this.transport.dispose(),this.recorder.EmergencySendRequired.unsubscribeAll(),this.recorder.EmergencySendRequired=null,this.stopStorageMonitor(),this.stopStateMonitor()},D.prototype.setTransmitOK=function(){r._.console.log("SR Log: setTransmitOK()."),this.transmitEnabled=!0,this._session[a.TRANSMIT_ENABLED]=!0,this.stg.set(a.TRANSMIT_ENABLED,!0),this._flushAndTransmit()},D.prototype.setTransmitNotOK=function(){r._.console.log("SR Log: setTransmitNotOK()."),this.transmitEnabled=!1,this._session[a.TRANSMIT_ENABLED]=!1,this.stg.set(a.TRANSMIT_ENABLED,!1)},D.prototype.cancelRecord=function(e){r._.console.log("SR Log: cancelRecord()."),this.setTransmitNotOK(),this.stopStateMonitor(),this.stopStorageMonitor(),this.canceled=!0,this._session[a.CANCELED]=!0,this.stg.setSession(a.CANCELED,!0,r.SYMBOLS.STORAGE.SCOPE.SESSION.TAB),e&&this.stg.set(_SESSION_SYMBOLS.CANCELEDPERMANENT,this.cancel),this._reset()},D.prototype._syncStorage=function(){var e=this._storage,t=this._backup_storage;if(e&&t&&e.isNew()&&!t.isNew()){var i=t.get(a.SESSION);e.set(a.SESSION,i);var n=t.getBlob();r._.console.log("_syncStorage",n.length),e.setBlob(n)}},D.prototype._syncSession=function(e,t,i){var n=this._storage||this._backup_storage;n&&(n.isNew()||!n.get(a.SESSION)||i?(this._session={},this.transmitEnabled=e,this._session[a.TRANSMIT_ENABLED]=this.transmitEnabled,this.stg.set(a.TRANSMIT_ENABLED,this.transmitEnabled),this.canceled=t,this._session[a.CANCELED]=this.canceled,this.stg.set(a.CANCELED,this.canceled),n.set(a.SESSION,this._session),n.commit()):(this._session=n.get(a.SESSION),r.isDefined(e)?(this.transmitEnabled=e,this._session[a.TRANSMIT_ENABLED]=this.transmitEnabled):(this.transmitEnabled=this._session[a.TRANSMIT_ENABLED],this.stg.set(a.TRANSMIT_ENABLED,this.transmitEnabled)),r.isDefined(t)?(this.canceled=t,this._session[a.CANCELED]=this.canceled):(this.canceled=this._session[a.CANCELED],this.stg.set(a.CANCELED,this.canceled))))},D.prototype._syncData=function(){this._storage?this._data=this._storage.getBlob():this._backup_storage&&(this._data=this._backup_storage.getBlob())},D.prototype._flushAndTransmit=function(e){if((this._storage||this._backup_storage)&&!this.canceled){var t=this.testStorageLimit();e&&r._.console.log("emergency requested on flushAndTransmit");var i=r.now();this.transmitEnabled&&(i-this.lastTransmissionTime>2e3||e)||t?(r._.console.log("flush and trasmit. now: "+i+", lastTransmissionTime:"+this.lastTransmissionTime+", diff: "+(i-this.lastTransmissionTime)),this._flush(),this._transmit(e)):e&&this.browser.isMobile&&(r._.console.log("isEmergency && this.browser.isMobile"),this.commitData(!0))}},D.prototype._getTransportUrl=function(){return r.getConfig("record_uri","record")+"record"},D.prototype._transmit=function(e){if(r.moduleStatus.isVisualEditorMode()||r.hasConflicting3PJS())return void(this._data="");var t=e?100:2e3,i=r.now();if(this.holdTransmits&&i-this.lastTransmissionTime<t)return this.hasEmergency=!0,void r._.console.log("no trasmit: timer doesn't expire. last transmit: "+this.lastTransmissionTime+", timing remaining: "+(i-this.lastTransmissionTime));if(r._.console.log("will transmit. last transmit: "+this.lastTransmissionTime+", timing remaining: "+(i-this.lastTransmissionTime)),r.globalSessionTracker.isSessionOver())return void r._.console.log("the session is over. don't call transmit");if(!r.isDefined(this.transport)||0===this._data.length)return void r._.console.log("no transmit: transport not defined or no data");this.holdTransmits=!0,this.hasEmergency=!1,this.lastTransmissionTime=i,r._.console.log("setting lastTransmissionTime: "+this.lastTransmissionTime);var n=this.siteid,o='{"data":['+this._data+"]}",s=('{"data":['+this._data+"]}",r.proxy(function(e){r._.console.log("SR Log: transmitting ",e.length>=this._data.length?"uncompressed":this.isAjax?"compressed size: "+Math.round(e.length/(this._data.length+10)*100)+"%":"SWF"),e=JSON.stringify({cp:e});var t="datalen:"+e.length+",time:"+r.now()+",cb:"+this.cobrowsing,i=this._getTransportUrl(),o=r.globalSessionTracker.getSessionMetadata().globalSessionId,s=r.globalSessionTracker.getSessionMetadata().sessionId;r._.console.log("ready to transmit. data length: "+e.length);var a=i+"?action=data&metadata="+encodeURIComponent(t)+"&encoding="+encodeURIComponent(x.getEncoding())+"&session_id="+encodeURIComponent(s)+"&global_session_id="+encodeURIComponent(o)+"&domain="+encodeURIComponent(this.domain)+"&cb="+this.cobrowsing+"&site_id="+encodeURIComponent(n)+"&version=0.1&cachebust="+Math.random();this.isTransmitting=!0,this.lastIndex+=1;var l=this.lastIndex+"";this.eventContainer[l]&&(l+=r.now()),r._.console.log("ready to transmit: "+this.transportid),this.transport.send({action:"data",contentType:"text/plain;charset=UTF-8",encoding:encodeURIComponent(x.getEncoding()),version:.1,gSessionId:o,sessionId:s,domain:this.domain||window.location.hostname,siteId:n,url:a,skipEncode:!0,data:e,failure:r.proxy(function(e){this.isTransmitting=!1,this.failCount++,this.holdTransmits=!1;try{e=JSON.parse(e)}catch(t){}if(r.isDefined(e.status)){Math.abs(parseInt(e.status))}return this.failCount>10?void this.cancelRecord():void(this.hasEmergency&&setTimeout(r.proxy(function(){r._.console.log("after failure emergency transmit"),this._flushAndTransmit(!0)},this),100))},this),success:function(e,t,i){return r._.console.log("transmit OK for id: "+t+", calling ping"),r.globalSessionTracker.ping(),function(n){e.failCount=0,e.isTransmitting=!1,e.holdTransmits=!1;try{n=JSON.parse(n)}catch(o){}if(r.isDefined(n.status)){var s=parseInt(n.status,10);if(1==s)t==e.transportid?e._data="":e._data.substr(0,i.length)==i&&(","==e._data[i.length]?e._data=e._data.substr(i.length+1):e._data=e._data.substr(i.length));else if(2==s)return void e.cancelRecord();this.hasEmergency&&setTimeout(function(){r._.console.log("emergency transmit"),e._flushAndTransmit(!0)},100)}}}(this,this.transportid,this._data+"")})},this));this.isAjax&&o.length>1e3?(r._.console.log("compressing the data"),d.fragmentAndCompressV2(o,1e5,this.browser,s)):s(o)},D.prototype._ping=function(){if(r.isDefined(this.transport)&&!this.canceled&&!this.isTransmitting&&this.transmitEnabled){if(r.now()-this.lastTransmissionTime<this.heartbeatInterval/2)return void r._.console.log("replay: skip ping. lastTransmissionTime: "+this.lastTransmissionTime+", now:"+r.now());r._.console.log("replay: sending ping. lastTransmissionTime: "+this.lastTransmissionTime+", now:"+r.now());var e=this.siteid;this.transport||(this.transport=new this.transport);var t=this._getTransportUrl();if(r.globalSessionTracker.isSessionOver())return void r._.console.log("Session is over. Don't send ping");var i=r.globalSessionTracker.getSessionMetadata().sessionId,n=r.globalSessionTracker.getSessionMetadata().globalSessionId;this.transport.send({action:"ping",contentType:"text/plain;charset=UTF-8",sessionId:i,siteId:e,url:t+"?action=ping&global_session_id="+encodeURIComponent(n)+"&session_id="+encodeURIComponent(i)+"&site_id="+encodeURIComponent(e)+"&cb="+this.cobrowsing+"&cachebust="+Math.random(),skipEncode:!0,data:"",failure:function(){},success:function(){}})}},D.prototype._reset=function(){this._log={start:r.now(),log:[],guid:r.generateGUID()},this._log_size_est=0},D.prototype._flush=function(){if(0!==this._log.log.length){this.transportid++,this._log.log.toJSON=null;var e=JSON.stringify(this._log);e&&e.length>0&&(this._data&&this._data.length>0?this._data=this._data+","+e:this._data=e),this._reset()}},D.prototype.logXPath=function(e,t){if(!this.canceled){if(t=t.join(","),!r.isDefined(this._quickXpathCache[t])){M[M.length]=t;var i=M.length-1;this._quickXpathCache[t]=i,this.log(e,D.EVENT_TYPES.XPATH_CACHE,{idx:i+"",xp:t},i)}return this._quickXpathCache[t]}},D.prototype.log=function(e,t,i,n,o,s){if(!this.canceled){var a=0;o||(o=0),s||(s=r.now());var l=s-this._log.start-o,c={x:r.isDefined(n)?n:this.logXPath(e,e.getPath()),e:t,p:r.globalSessionTracker.getPV(),d:i,t:l};this._log.log[this._log.log.length]=c,t==D.EVENT_TYPES.DOM_SERIALIZE?i.dom.str&&(a=i.dom.str.length,this._log_size_est+=a):t==D.EVENT_TYPES.CSS_SERIALIZE?i.stylesheet?(a=i.stylesheet.length,this._log_size_est+=a):i.v&&(a=Math.round(1*i.v.length),this._log_size_est+=a):t==D.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED?i.h.str||i.h.diff?(a=Math.round(1*((i.h.str?i.h.str.length:0)+(i.h.diff?i.h.diff.d.r.length:0)+(i.h.kl?i.h.kl.length:0)+(i.h.uid?i.h.uid.length:0))),a+=50,this._log_size_est+=a):(a=84,this._log_size_est+=a):(a=60,this._log_size_est+=a),t!==D.EVENT_TYPES.TAP&&t!==D.EVENT_TYPES.PRESS||(r._.console.log("logged tap/press"),this.commitData(!0))}},D.prototype.testStorageLimit=function(){return this._data.length+this._log_size_est>3e6},D.prototype._monitorState=function(){var e=this.stg.get([a.CANCELED,a.TRANSMIT_ENABLED]),t=!1,i=!0;return e&&(t=e[a.CANCELED],i=e[a.TRANSMIT_ENABLED]),r.isDefined(t)&&this.canceled!=t&&t?void this.cancelRecord():void(r.isDefined(i)&&this.transmitEnabled!=i&&(i?this.setTransmitOK():this.setTransmitNotOK()))},D.prototype.startStateMonitor=function(){this.stateMonitor||(this._monitorState(),this.stateMonitor=setInterval(r.proxy(function(){this._monitorState()},this),2e3))},D.prototype.stopStateMonitor=function(){this.stateMonitor&&(clearInterval(this.stateMonitor),delete this.stateMonitor)},D.prototype.startStorageMonitor=function(){this.storageMonitor||(this.storageMonitor=setInterval(r.proxy(function(){r._.console.log("storage monitor fired"),this._flushAndTransmit()},this),this.browser.isMobile?this.mobileTransmitInterval:this.transmitInterval))},D.prototype.stopStorageMonitor=function(){this.storageMonitor&&(clearInterval(this.storageMonitor),delete this.storageMonitor)},D.prototype.getEventTypes=function(){return D.EVENT_TYPES},D.prototype._resetXPathCache=function(){M=[],this._quickXpathCache={}},D.EVENT_TYPES={DOM_SERIALIZE:0,XPATH_CACHE:1,FRAME_SIZE:2,FRAME_SCROLL:3,MOUSE_MOVE:4,WINDOW_MOUSEOUT_MOUSEENTER:5,INPUT_SERIALIZE:6,FOCUS_BLUR:7,KEY_PRESS:8,CARET_INFO:9,VALUE_CHANGED:10,DOM_MUTATION_NODE_MODIFIED:11,DOM_MUTATION_NODE_ATTR_MODIFIED:12,JAVASCRIPT_ERROR:13,MOUSE_CLICK:14,MOUSE_DOWN:15,MOUSE_UP:16,PAGE_MARKER:17,DOC_SIZE:18,SCROLL_EL:19,NOT_RECORDED:20,CSS_SERIALIZE:21,ORIENTATION:22,ZOOM:23,TOUCH:24,INCOMPLETE_INPUT_CAPTURE:25,ORIENTATION_CHANGE:26,CUSTOM_BEHAVIOR:27,CUSTOM_ERROR:28,TAP:32,PRESS:33,SWIPE:34,PINCH:35};var k={};k.increment=function(e,t){try{var r=e.get("meta")||{};r[t]=(r[t]||0)+1,e.set("meta",r)}catch(i){}},k.set=function(e,t,r){try{var i=e.get("meta")||{};i[t]=r,e.set("meta",i)}catch(n){}};var x={};x.nodeBelongsTo=function(e,t){if(t.contains)return t.contains(e);if(t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));for(;e.parentNode;){if(e==t||e==t.body)return!0;e=e.parentNode}return!1},x.getEncoding=function(){return C._browser.isIE?window.document.charset:window.document.characterSet},x.getParentWindow=function(e){var t=e;if(e){if(e._pw)return e._pw;if(e.ownerDocument&&e.ownerDocument.defaultView)return e.ownerDocument.defaultView;for(;e.parentNode||e.document;){if(e.document)return t._pw=e,e;e=e.parentNode}}},x.getStyle=function(e,t,r){var i="",n=t.document.defaultView;return n&&n.getComputedStyle&&n.getComputedStyle(e,"")?i=n.getComputedStyle(e,"").getPropertyValue(r):e.currentStyle&&(r=r.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),i=e.currentStyle[r]),i},x.getPosition=function(e,t){for(var r=0,i=0,n=x.getStyle;e;)r+=e.offsetTop+(parseFloat(n(e,t,"borderTopWidth"))||0),i+=e.offsetLeft+(parseFloat(n(e,t,"borderLeftWidth"))||0),e=e.offsetParent;return{x:i,y:r}},x.getPositionRelativeToMainView=function(e,t,i){for(var n,o=!1;!o&&t;){o=t.parent==t;var s=x.getPosition(e,t),a=r.GetScroll(t);i&&!o&&(s.x-=a.x,s.y-=a.y),n?(n.x+=s.x,n.y+=s.y):n=s,e=t.frameElement,t=t.parent}return n},x.getDocSize=function(e){var t=e||window.document,r=t.body,i=t.documentElement,n=Math.max;return{width:n(n(r.scrollWidth,i.scrollWidth),n(r.offsetWidth,i.offsetWidth),n(r.clientWidth,i.clientWidth)),height:n(n(r.scrollHeight,i.scrollHeight),n(r.offsetHeight,i.offsetHeight),n(r.clientHeight,i.clientHeight))}},x.externalizeStyleCSSTextToInnerHTML=function(e){var t,i,n=!1;if(r.isDefined(r.getConfig("useCSSText","record"))||(t=document.createElement("style"),t.setAttribute("type","text/css"),r.setConfig("useCSSText",r.isDefined(t.styleSheet),"record")),r.getConfig("useCSSText","record")){t="style"==e.nodeName.toLowerCase()?[e]:e.querySelectorAll("style");for(var o=0,s=t.length;o<s;o++)i=t[o],i.styleSheet&&i.styleSheet.cssText&&i.styleSheet.cssText.replace(/\s/gi,"").length!=i.innerHTML.replace(/\s/gi,"").length&&(i.innerHTML=i.styleSheet.cssText,n=!0)}return n};var L={dynamicSelectorsToMask:[],dynamicSelectorsToUnmask:[],dynamicSelectorsToRemask:[],dynamicSelectorsToBlockAssets:[],isMasking:!1,noMaskClassArray:[]},A="arHiddenBlockStart",I="arHiddenBlockEnd";L._maskStaticBySelector=function(e,t){for(var r=t.document.querySelectorAll(e),i=window.document,n=0;n<r.length;n++){var o=r[n];if(o.nodeName.toLowerCase().indexOf("body")>-1)o.insertBefore(i.createComment(A),o.firstChild),o.appendChild(i.createComment(I));else{var s=o.parentNode;s.insertBefore(i.createComment(A),o),s.insertBefore(i.createComment(I),o.nextSibling)}}},L._remaskBySelector=function(e,t){r.removeClass(t.document.querySelectorAll(e),"arVisible")},L._unmaskStaticBySelector=function(e,t){r.addClass(t.document.querySelectorAll(e),"arVisible")},L._obscureBySelector=function(e,t){r.addClass(t.document.querySelectorAll(e),"arObscure")},L._maskDynamicBySelector=function(e,t,r){var i=L;e.length>0&&"string"==typeof e&&(void 0===r||""===r||"inTxBlk"===r?(i._maskStaticBySelector(e,t),i.dynamicSelectorsToMask[i.dynamicSelectorsToMask.length]=e):"evUnblk"===r?(i._unmaskStaticBySelector(e,t),i.dynamicSelectorsToUnmask[i.dynamicSelectorsToUnmask.length]=e):"evReblk"===r&&(i._remaskBySelector(e,t),i.dynamicSelectorsToRemask[i.dynamicSelectorsToRemask.length]=e))},L._unmaskDynamicBySelector=function(e,t){L._maskDynamicBySelector(e,t,"evUnblk")},L._maskAssetDynamicBySelector=function(e,t){if(r.addClass(t.document.querySelectorAll(e),"arHidden"),e.length>0){"string"==typeof e&&(e=[e]);for(var i=L.dynamicSelectorsToBlockAssets,n=0;n<e.length;n++)i[i.length]=e[n]}},L._removeVisibility=function(e,t){L._maskDynamicBySelector(e,t,"evReblk")},L.addClassToNoMaskArray=function(e){L.noMaskClassArray[L.noMaskClassArray.length]=e},L.isNodeMasked=function(e){var t=!0;if(L.noMaskClassArray.length>0&&e.className)for(var r=L.noMaskClassArray,i=0;i<r.length;i++){var n=r[i];e.className.indexOf(n)>-1&&(t=!1),i=n=null}return e.childNodes.length<1||!t||!!(e.childNodes[0].data&&e.childNodes[0].data.indexOf(A)>-1)},L._tagDynamicMaskNodes=function(e,t,i){var n,o,s=!1;if(!L.isMasking){if(L.isMasking=!0,L.dynamicSelectorsToMask.length>0&&!t){var a=i.document.querySelectorAll(L.dynamicSelectorsToMask.join(","));for(n=0,o=a.length;n<o;n++)if(x.nodeBelongsTo(e,a[n])||a[n]==e){if(!L.isNodeMasked(e)){s=!0;break}}else x.nodeBelongsTo(a[n],e)&&(L.isNodeMasked(a[n])||(a[n].insertBefore(window.document.createComment(A),a[n].firstChild),a[n].appendChild(window.document.createComment(I))))}var l;if(i!=window)try{l=i.document}catch(c){return}else l=i.document;if(L.dynamicSelectorsToUnmask.length>0){for(n=L.dynamicSelectorsToUnmask.length-1;n>=0;n--)r.addClass(l.querySelectorAll(L.dynamicSelectorsToUnmask[n]),"arVisible");for(o=L.dynamicSelectorsToRemask.length-1;o>=0;o--)r.removeClass(l.querySelectorAll(L.dynamicSelectorsToRemask[o]),"arVisible")}if(L.dynamicSelectorsToBlockAssets.length>0)for(n=L.dynamicSelectorsToBlockAssets.length-1;n>=0;n--)r.addClass(l.querySelectorAll(L.dynamicSelectorsToBlockAssets[n]),"arHidden");L.isMasking=!1}return s},L.maskDocument=function(e,t){var i=(t.location.href||"about:blank").toLowerCase(),n=function(e,t,r){for(var n in e){var o=new RegExp(n,"i");o.test(i)&&t(e[n],r)}},o=r.getBaseBlockedEls();o&&(e.staticBlockEls=r._.extend({},e.staticBlockEls,o),e.dynamicBlockEls=r._.extend({},e.dynamicBlockEls,o),e.assetBlockEls=r._.extend({},e.assetBlockEls,o),e.removeVisibilityEls=r._.extend({},e.removeVisibilityEls,o),e.obscureEls=r._.extend({},e.obscureEls,o)),n(e.staticBlockEls,this._maskStaticBySelector,t),n(e.dynamicBlockEls,this._maskDynamicBySelector,t),n(e.staticVisibleEls,this._unmaskStaticBySelector,t),n(e.dynamicVisibleEls,this._unmaskDynamicBySelector,t),n(e.assetBlockEls,this._maskAssetDynamicBySelector,t),n(e.removeVisibilityEls,this._removeVisibility,t),n(e.obscureEls,this._obscureBySelector,t)};var O=function(e,t,i,n,o){r._.console.log("setting up record on ",n?n:"top frame"),b._browser=C._browser=this.browser=t,this.isInit=!1,this.stg=e,this.win=i,this.ready=new r.AurycEvent,this.childRecorders=[],this.disposed=!1,this.DomUpdated=new r.AurycEvent,this.DomUpdated.subscribe(r.proxy(function(){this.update.apply(this,arguments)},this)),this.EmergencySendRequired=new r.AurycEvent,this.instancePath=n||[],this.isMousedOverWindow=!1,this.logger=this.eventcap=this.recordParent=null,this.win.document&&(this.recordParent=o,o||(this.logger=new D(e,t,this)),this.getLogger().StorageReady.subscribe(r.proxy(function(){r._.console.log("SR: StorageReady"),this.ready.fire();var e=r.getConfig("events.onBeforeRecord","record");if(null!==e){var t=e.apply(this);if(t)return void(this.win==this.win.top&&this.getLogger().log(this,D.EVENT_TYPES.NOT_RECORDED,{v:t},-1))}r._.console.log("emergency send for DOM");var i=r.getConfig("events.onAfterSerialize","record");r.isDefined(i)&&i.apply(this)},this),!0,!0));var s=this;r.SubPub.subscribe(r.SYMBOLS.EVENT.NEW_SESSION,function(e){s.isInit&&(r._.console.log("New session, calling reinit"),r._.console.log(e),s.newSession(e),r._.console.log("Reinit done"))}),r.SubPub.subscribe(r.SYMBOLS.EVENT.PAGEVIEWTRIGGER,function(e){s.newPage(!0,e.startTS),s.eventcap||(s.eventcap=new C(s,t),p.performFrameBindings(s),o||(r._.console.log("Emergency transmit invoked for: "+document.location.href),s.logger.commitData(!0)))}),r.SubPub.subscribe(r.SYMBOLS.EVENT.FEEDBACKTRIGGER,function(e){r._.console.log("subscribe replay FEEDBACKTRIGGER",e);var t=s.getLogger().getEventTypes().CUSTOM_BEHAVIOR,i={p:e.eventProperties.formid,et:e.eventProperties.et};s.getLogger().log(s,t,{a:"feedback",v:JSON.stringify(i)},null,null,e.currentTime)}),r.SubPub.subscribe(r.SYMBOLS.EVENT.TRACKCUSTOMEVENT,function(e){r._.console.log("subscribe replay TRACKCUSTOMEVENT",e);var t=s.getLogger().getEventTypes().CUSTOM_BEHAVIOR,i=e.eventName,n=e.eventProperties;s.getLogger().log(s,t,{a:i,v:JSON.stringify(n)},null,null,e.currentTime)}),o=null,i=null,n=null};O.prototype.logPageMarker=function(e,i){var n;n=i?i:t.startTS?Math.max(r.now(),t.startTS):r.now();var o=r.getScreenResolution();this.getLogger().log(this,D.EVENT_TYPES.PAGE_MARKER,{dtm:n,ofs:(new Date).getTimezoneOffset(),v:e.browser.name,dv:e.browser.version,sid:r.getConfig("siteid"),r:"W3C",l:r.getConfig("layout","record")||"",m:e.isMobile,a:e.deviceType,f:document.referrer.toString(),sz:{w:o.w,h:o.h}},-1),this.getLogger().logVisibilityChange(n),this.stg.set(r.SYMBOLS.EVENT.PV_START_TS,n)},O.prototype.update=function(e){e||(e=this.doc.body),0!==e.childNodes.length&&(this.eventcap.updateNodeBinding(e,!!e),p.performFrameBindings(this,e))},O.prototype.getLogger=function(){return this.recordParent?this.recordParent.getLogger():this.logger},O.prototype.logCustomEvent=function(e,t,i){r.isDefined(e)&&"string"==typeof e||(e=""),this.getLogger().log(this,i,{a:e,v:JSON.stringify(t)})},O.prototype.logUrlChangeEvent=function(e,t){r.isDefined(e)&&e.url&&this.newPage(!0,t)},O.prototype.newSession=function(){this.getLogger().reSyncSession(),this.getLogger()._reset()},O.prototype.newPage=function(e,t){b.reset(b._browser),e&&(this.getLogger().commitData(),this.getLogger()._reset(),this.getLogger()._resetXPathCache()),this.logPageMarker(b._browser,t),this.serializeDom(!0,t),this.initSize()},O.prototype.initSize=function(){var e=r.GetSize(this.win),t=0,i=this.getLogger(),n=x.getDocSize(this.doc),o={w:n.width,h:n.height};if(this.docSize=n,this.browser.isMobile){var s=e;e=o,o=s,t=window.orientation}e.w>0&&e.h>0&&o.w>0&&o.h>0&&i.log(this,this.getLogger().getEventTypes().FRAME_SIZE,{sz:e,avs:o,st:t,m:this.browser.isMobile},null,-350),n.width>0&&n.height>0&&i.log(this,this.getLogger().getEventTypes().DOC_SIZE,{sz:{w:n.width,h:n.height}},null,-340)},O.prototype.getPath=function(){return this._getPathCache||(this.recordParent?this._getPathCache=this.instancePath.concat(this.recordParent.getPath()):this._getPathCache=this.instancePath),this._getPathCache},O.prototype.getTop=function(){return this.recordParent?this.recordParent.getTop():this},O.prototype.setTransmitOK=function(){this.getLogger().setTransmitOK()},O.prototype.setTransmitNotOK=function(){this.getLogger().setTransmitNotOK()},O.prototype.cancelRecord=function(e){this.getLogger().cancelRecord(e)},O.prototype.dispose=function(){var e=this;if(e.win||(e=e.recorder),!this.disposed){this.disposed=!0;for(var t=0;t<e.childRecorders.length;t++)e.childRecorders[t].dispose();e.eventcap&&e.eventcap.dispose(),e.lastRawMouseCoords&&(e.lastRawMouseCoords=null),e.eventcap=null,e.win=null,e.recordParent=null,e.DomUpdated.unsubscribeAll(),e.DomUpdated=null,e.logger&&(e.logger.dispose(),e.logger=null),e=null,r.Unbind("record:*")}},O.prototype.getDomLoadTime=function(){var e=r.now(),i=window.performance&&window.performance.timing&&window.performance.timing.responseStart,n=window.performance&&window.performance.timing&&window.performance.timing.responseEnd,o=i&&n?n-i:-1;return Math.min(Math.max(1,o,e-t.startTS),1e4)},O.prototype.serializeDom=function(e,t){if(this.getLogger()){var i;if(this.win==this.win.top&&!e){var n=this.win.document.body;i=b.getCacheableObject(n.innerHTML,E.getMapping(n)).uid}r.getConfig("IECSSText","record")&&x.externalizeStyleCSSTextToInnerHTML(this.win.document),L.maskDocument(r.getConfig("pii","record"),this.win);var o=v._getDocType(this.win.document)||"<!DOCTYPE html>",s=t?t:r.globalSessionTracker.getPVStartTS();this.getLogger().log(this,D.EVENT_TYPES.DOM_SERIALIZE,{dom:v(this.win,this.getPath()),url:this.win.location.href.toString(),v:this.browser.agent,buid:i,start:s,domloadtime:this.getDomLoadTime(),a:o})}e||(this.isInit=!0)};var R=function(e,t){var i={};return e.aurycRecordAPI||(e.aurycRecordAPI={}),i.isReplayProductEnabled=function(){return!!t},t?(i.beginTransmitting=function(){t.beginTransmitting()},i.cancelRecord=function(){t.cancelRecord()},i.getSession=function(){var e=(t.recorder.logger,r.globalSessionTracker.getSessionMetadata());return{sessionid:e.sessionId,gsessionid:e.globalSessionId,sig:e.globalSessionId+"/"+e.sessionId}},i.getReplayUrl=function(e){var i=t.recorder.logger,n=i.siteid,o=r.globalSessionTracker.getSessionMetadata().globalSessionId;if(e&&"function"==typeof e){var s="https://portal.auryc.com/auth/replay/playback?q="+n+":"+o;r._.console.log("playback url:"+s),e(s)}},void r.ext(e.aurycRecordAPI,i,!1)):void r.ext(e.aurycRecordAPI,i,!1)},P=function(e,t,r){this.recordCtl=e,this.config=t,this.browser=r};P.prototype.supported=function(){if(!this.recordCtl.isConfigValid())return r._.console.warn("record: recordcontroller reported invalid config"),!1;var e=this.config,t=this.browser;if(e.browser_cutoff[t.browser.name]&&t.browser.actualVersion<e.browser_cutoff[t.browser.name])return!1;if(e.platform_cutoff[t.os.name]&&t.os.version<e.platform_cutoff[t.os.name])return!1;for(var i=0;i<e.device_blacklist.length;i++)if(t.agent.toLowerCase().indexOf(e.device_blacklist[i].toLowerCase())>-1)return!1;return!0},P.prototype.enabled=function(){if(!this.recordCtl.isConfigValid())return r._.console.warn("record: recordcontroller reported invalid config"),!1;var e=this.config,t=e.filters,i=!0;if(t&&t.mode)if("w"===t.mode){i=!1;var n=t.domains;if(n&&n.length>0)for(var o=0;o<n.length;o++){var s=new RegExp(n[o],"i");s.test(location.href)&&(i=!0)}}else if("b"===t.mode){var a=t.domains;if(a&&a.length>0)for(var l=0;l<a.length;l++){var c=new RegExp(a[l],"i");c.test(location.href)&&(i=!0)}}if(i){var h=e.sampling;if("undefined"==typeof h||null===h)return i;if(0===h)i=!1;else{var d=sessionStorage.getItem("auryc_replay_v2");if(d)i="t"===d;else{var u=100*Math.random();i=u<h,sessionStorage.setItem("auryc_replay_v2",i?"t":"f")}}}return i};var s=function(e,t,i){this.winobj=t,this.browser=e,this.cfg=r.getProductConfig("record"),this.isValidCfg=this._validateConfig(this.cfg),this.crit=new P(this,this.cfg,e),this.stg=i};return s.IsConfigValid=function(e){return e?!!(e.browser_cutoff&&e.platform_cutoff&&e.device_blacklist)||(r._.console.error("record: mandatory configs missing: browser_cutoff, platform_cutoff, device_blacklist"),!1):(r._.console.error("record: config object is null"),!1)},s.prototype.isConfigValid=function(){return this.isValidCfg},s.prototype._validateConfig=function(e){return e?!!(e.browser_cutoff&&e.platform_cutoff&&e.device_blacklist)||(r._.console.error("record: mandatory configs missing: browser_cutoff, platform_cutoff, device_blacklist"),!1):(r._.console.error("record: config object is null"),!1)},s.prototype.init=function(e){this.browser.browserReady.subscribe(r.proxy(function(){this.crit.supported()&&this.crit.enabled()?(this.recorder=new O(this.stg,this.browser,this.winobj),r.Bind(window,"unload",r.proxy(function(){this.recorder&&(this.recorder.dispose(),this.recorder=null)},this)),R(this.winobj,this),e&&this.recorder.setTransmitOK()):(this.crit.supported()||r._.console.warn("SR: record device or platform not supported"),this.crit.enabled()||r._.console.warn("SR: record not enabled"))},this),!0,!0)},s.prototype.beginTransmitting=function(){this.recorder&&this.recorder.setTransmitOK()},s.prototype.cancelRecord=function(){this.recorder&&(this.recorder.dispose(),this.recorder=null)},r.isProductEnabled("record")?(r._.console.log("record product enabled"),void r.SubPub.subscribe(r.SYMBOLS.EVENT.UBTINIT,function(){var e=r.globalSessionTracker.getSessionStorage(),t=new r.Browser,i=new s(t,window,e);if(!i.isConfigValid())return void r._.console.critical("record config is invalid. Not recording");if(r.moduleStatus.isVisualEditorMode())i.init();else{var n=!0;i.init(n),R(window,i)}})):(r._.console.warn("record product disabled"),void R(window,null))});